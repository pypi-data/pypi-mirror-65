import shutil
import six

from DKCommon.DKFileEncode import DKFileEncode
from DKCommon.DKPathUtils import is_windows_os

from DKCloudCommand.modules.DKZipHelper import DKZipHelper
from ..DKCommonUnitTestSettings import DKCommonUnitTestSettings


class TestDKZipHelper(DKCommonUnitTestSettings):
    _TEMP_FILE_LOCATION = '/var/tmp'

    def setUp(self):
        self.temp_dir = None
        if is_windows_os():
            TestDKZipHelper._TEMP_FILE_LOCATION = 'c:\\temp'
        else:
            TestDKZipHelper._TEMP_FILE_LOCATION = '/var/tmp'

    def tearDown(self):
        if self.temp_dir:
            shutil.rmtree(self.temp_dir, ignore_errors=True)

    def test_unzip_first_file_as_string_or_unicode(self):
        base_64_input = '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'  # noqa: E501
        zipped_input = DKFileEncode.b64decode(base_64_input)
        output_as_string = DKZipHelper.unzip_first_file_as_string_or_unicode(zipped_input)
        self.assertIsNotNone(output_as_string)
        self.assertTrue(isinstance(output_as_string, six.string_types))
        self.assertTrue('Ending variation make thread' in output_as_string)
