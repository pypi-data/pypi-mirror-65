(this["webpackJsonpohmyddl-frontend"]=this["webpackJsonpohmyddl-frontend"]||[]).push([[0],{108:function(e,t,a){},111:function(e,t,a){"use strict";a.r(t);var n=a(0),o=a.n(n),r=a(10),s=a.n(r),i=(a(83),a(21)),l=a(22),c=a(26),u=a(27),d=(a(84),a(39)),m=a(29),g=a(152),h=a(153),f=a(113),v=a(144),p=a(65),w=(a(85),a(139)),E=a(154),k=a(143),b=a(155),y=a(31),S=a.n(y),C=function(e){Object(u.a)(a,e);var t=Object(c.a)(a);function a(e){var n;return Object(i.a)(this,a),(n=t.call(this,e)).state={userName:"",password:"",savePassword:!0,logining:!1,redirect:"",errorMessage:""},n}return Object(l.a)(a,[{key:"onTextChange",value:function(e){var t=e.target.name,a="";a="checkbox"===e.target.type?e.target.checked:e.target.value,this.setState(Object(p.a)({},t,a))}},{key:"savePassword",value:function(e){var t=window.localStorage;e?(t.setItem("userName",this.state.userName),t.setItem("password",this.state.password),console.log("saved username and password")):(t.removeItem("userName"),t.removeItem("password"),console.log("clear username and password"))}},{key:"onLogin",value:function(e){var t=this;e.preventDefault();var a=this.state.userName,n=this.state.password;console.log("savePassword: "+this.state.savePassword),this.setState({logining:!0,errorMessage:""}),S.a.post("/api/login",{username:a,password:n}).then((function(e){if(console.log(e.data),0===e.data.ret)console.log("\u767b\u5f55\u6210\u529f"),t.state.savePassword?t.savePassword(!0):t.savePassword(!1),t.props.onLoginStatusChange(!0),t.setState({redirect:"/worklist",logining:!1});else{var a="";a=2===e.data.ret?"\u5b66\u53f7\u6216\u5bc6\u7801\u9519\u8bef":e.data.message,console.log("\u767b\u5f55\u5931\u8d25\uff1a"+e.data.message),t.setState({errorMessage:a,logining:!1})}})).catch((function(e){t.setState({errorMessage:"\u767b\u5f55\u5931\u8d25:"+e,logining:!1})}))}},{key:"componentDidMount",value:function(){var e=window.localStorage,t=e.getItem("userName"),a=e.getItem("password");null!==t&&this.setState({userName:t}),null!==a&&this.setState({password:a})}},{key:"render",value:function(){var e=this;return o.a.createElement("div",{id:"login-container"},this.state.logining&&o.a.createElement(w.a,null),o.a.createElement("h1",null,"\u767b\u5f55"),o.a.createElement("form",{onSubmit:function(t){return e.onLogin(t)}},o.a.createElement(E.a,{onChange:function(t){return e.onTextChange(t)},name:"userName",autoComplete:"off",label:"\u5b66\u53f7",fullWidth:!0,type:"number",value:this.state.userName}),o.a.createElement(E.a,{onChange:function(t){return e.onTextChange(t)},name:"password",autoComplete:"off",label:"\u5bc6\u7801",fullWidth:!0,type:"password",value:this.state.password}),o.a.createElement(k.a,{label:"\u8bb0\u4f4f\u5bc6\u7801",control:o.a.createElement(b.a,{onChange:function(t){return e.onTextChange(t)},color:"primary",name:"savePassword",defaultChecked:!0})}),this.state.errorMessage&&o.a.createElement(f.a,{id:"error-message"},this.state.errorMessage),o.a.createElement(v.a,{disabled:this.state.logining,variant:"contained",color:"primary",fullWidth:!0,id:"submit-btn",type:"submit"},this.state.logining?"\u767b\u5f55\u4e2d...":"\u767b\u5f55")),o.a.createElement(f.a,{id:"bottom-tips"},"\u5bc6\u7801\u662f\u4e00\u5361\u901a\u5bc6\u7801\uff0c\u4ec5\u7528\u4e8e *.shu.edu.cn\u3002\u65e0\u987b\u591a\u8651\u3002"),this.state.redirect&&o.a.createElement(m.a,{to:this.state.redirect}))}}]),a}(o.a.Component),L=function(e){Object(u.a)(a,e);var t=Object(c.a)(a);function a(){return Object(i.a)(this,a),t.apply(this,arguments)}return Object(l.a)(a,[{key:"render",value:function(){return o.a.createElement("div",null,o.a.createElement(m.a,{to:this.props.isLogined?"/worklist":"/login"}))}}]),a}(o.a.Component),O=(a(108),a(145)),j=a(112),N=a(146),I=a(147),_=a(148),M=a(149),D=a(150),P=a(151),T=a(70),x=a.n(T);function W(e){var t=1e3*parseFloat(e);if(t<0)return"\u672a\u77e5";if(t<1585885e3)return"-";var a=new Date(t);return a.toLocaleDateString()+" "+a.toLocaleTimeString()}function R(e){return o.a.createElement(_.a,null,o.a.createElement(M.a,null,e.courseName),o.a.createElement(M.a,{onClick:e.onClick},e.workName),o.a.createElement(M.a,null,W(e.deadline)))}var B=function(e){Object(u.a)(a,e);var t=Object(c.a)(a);function a(e){var n;return Object(i.a)(this,a),(n=t.call(this,e)).state={workData:[],update_at:0,refershing:!1},n}return Object(l.a)(a,[{key:"onItemClick",value:function(e){console.log("clicked"),console.log(e.target)}},{key:"onRefersh",value:function(e){var t=this;console.log("refershing..."),this.setState({refershing:!0}),S.a.post("/api/get_unfinish_works",{disable_cache:e}).then((function(e){console.log(e),0===e.data.ret?t.setState({workData:e.data.data,update_at:e.data.update_at}):console.log("\u5237\u65b0\u5931\u8d25\uff01")})).catch((function(e){console.log("\u5237\u65b0\u5931\u8d25:"+e)})).then((function(){t.setState({refershing:!1})}))}},{key:"componentDidMount",value:function(){this.onRefersh(!1)}},{key:"render",value:function(){var e=this,t=this.state.workData.map((function(t){return o.a.createElement(R,{onClick:function(t){return e.onItemClick(t)},courseName:t.courseName,workName:t.workName,deadline:t.deadline,key:t.workName})}));return o.a.createElement("div",{id:"worklist-container"},this.state.refershing&&o.a.createElement(w.a,{variant:"query"}),o.a.createElement(O.a,{component:j.a},o.a.createElement(N.a,null,o.a.createElement(I.a,null,o.a.createElement(_.a,null,o.a.createElement(M.a,null,"\u8bfe\u7a0b"),o.a.createElement(M.a,null,"\u4f5c\u4e1a"),o.a.createElement(M.a,null,"\u622a\u6b62\u65f6\u95f4"))),o.a.createElement(D.a,null,t))),o.a.createElement(f.a,{id:"update-time"},"\u6570\u636e\u66f4\u65b0\u4e8e\uff1a",W(this.state.update_at)),o.a.createElement(P.a,{disabled:this.state.refershing,color:"primary",id:"refersh-btn",onClick:function(){return e.onRefersh(!0)}},o.a.createElement(x.a,null)))}}]),a}(o.a.Component),J=function(e){Object(u.a)(a,e);var t=Object(c.a)(a);function a(e){var n;Object(i.a)(this,a),n=t.call(this,e);var o=window.localStorage;return n.state={isLogined:"true"===o.getItem("isLogined"),redirect:""},console.log=function(){},n}return Object(l.a)(a,[{key:"check_auth",value:function(){var e=this;S.a.post("/api/check_sid").then((function(t){console.log(t),0===t.data.ret&&t.data.sid_available?(console.log("sid available"),e.setState({redirect:"/worklist"}),e.onLoginStatusChange(!0)):(console.log("sid inavailable"),e.setState({redirect:"/login"}),e.onLoginStatusChange(!1))}))}},{key:"onLoginStatusChange",value:function(e){this.setState({isLogined:e}),window.localStorage.setItem("isLogined",""+e),console.log("isLogined? "+e)}},{key:"redirectTo",value:function(e){this.setState({redirect:e})}},{key:"onLogout",value:function(){var e=this;S.a.post("/api/logout").then((function(t){0===t.data.ret&&(console.log("logout success"),e.onLoginStatusChange(!1),e.redirectTo("/login"))}))}},{key:"componentDidMount",value:function(){this.check_auth()}},{key:"render",value:function(){var e=this;return o.a.createElement("div",{className:"App"},o.a.createElement(d.a,null,o.a.createElement(g.a,{position:"static"},o.a.createElement(h.a,{id:"navbar"},o.a.createElement(f.a,{variant:"h5",id:"navbar-brand"},"Oh-my-ddl"),this.state.isLogined&&o.a.createElement(v.a,{onClick:function(){return e.onLogout()}},"\u767b\u51fa")),this.state.redirect&&o.a.createElement(m.a,{to:this.state.redirect})),o.a.createElement(m.d,null,o.a.createElement(m.b,{path:"/login"},o.a.createElement(C,{onLoginStatusChange:function(t){return e.onLoginStatusChange(t)}})),o.a.createElement(m.b,{path:"/worklist"},o.a.createElement(B,null)),o.a.createElement(m.b,{path:"/"},o.a.createElement(L,{isLogined:this.state.isLogined})))))}}]),a}(o.a.Component);Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));s.a.render(o.a.createElement(o.a.StrictMode,null,o.a.createElement(J,null)),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()})).catch((function(e){console.error(e.message)}))},78:function(e,t,a){e.exports=a(111)},83:function(e,t,a){},84:function(e,t,a){},85:function(e,t,a){}},[[78,1,2]]]);
//# sourceMappingURL=main.654a3e47.chunk.js.map