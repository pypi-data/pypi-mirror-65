{"version":3,"sources":["webpack:///./src/mixins/events-mixin.js","webpack:///./src/common/dom/setup-leaflet-map.ts","webpack:///./node_modules/@polymer/iron-image/iron-image.js","webpack:///./src/panels/map/ha-entity-marker.js","webpack:///./src/common/util/parse-aspect-ratio.ts","webpack:///./src/panels/lovelace/cards/hui-map-card.ts"],"names":["EventsMixin","dedupingMixin","superClass","_superClass","_class","_classCallCheck","this","_possibleConstructorReturn","_getPrototypeOf","apply","arguments","_inherits","key","value","type","detail","options","fireEvent","node","setupLeafletMap","_ref","regeneratorRuntime","mark","_callee","mapElement","darkMode","draw","Leaflet","map","style","_args","wrap","_context","prev","next","length","undefined","parentNode","Error","__webpack_require__","e","then","t","bind","sent","Icon","Default","imagePath","document","createElement","setAttribute","appendChild","setView","createTileLayer","addTo","abrupt","stop","_x","leaflet","tileLayer","concat","Browser","retina","attribution","subdomains","minZoom","maxZoom","Polymer","_template","html","_templateObject","is","properties","src","String","alt","crossorigin","preventLoad","Boolean","sizing","reflectToAttribute","position","preload","placeholder","observer","fade","loaded","notify","readOnly","loading","error","width","Number","height","observers","created","_resolvedSrc","_imgOnLoad","$","img","_resolveSrc","_setLoading","_setLoaded","_setError","_imgOnError","removeAttribute","sizedImgDiv","backgroundImage","_computePlaceholderHidden","_computePlaceholderClassName","_computeImgDivHidden","_computeImgDivARIAHidden","_computeImgDivARIALabel","replace","split","pop","_computeImgHidden","_widthChanged","isNaN","_heightChanged","_loadStateObserver","newResolvedSrc","_placeholderChanged","_transformChanged","sizedImgDivStyle","placeholderStyle","backgroundSize","backgroundPosition","backgroundRepeat","testSrc","resolved","resolveUrl","baseURIAnchor","href","location","origin","protocol","host","HaEntityMarker","PolymerElement","hass","Object","entityId","entityName","entityPicture","_this","_get","prototype","call","addEventListener","ev","badgeTap","stopPropagation","fire","customElements","define","d","__webpack_exports__","parseAspectRatio","parseOrThrow","num","parsed","parseFloat","input","endsWith","w","h","substr","arr","err","customElement","HuiMapCard","Promise","all","lovelaceConfig","entities","entitiesFill","findEntities","property","reflect","debounce","_this2","_leafletMap","invalidateSize","config","geo_location_sources","Array","isArray","_config","_configEntities","processConfigEntities","ratio","aspect_ratio","ar","toFixed","Math","floor","_connected","hasUpdated","loadMap","_attachObserver","remove","_resizeObserver","unobserve","_mapEl","window","removeEventListener","_debouncedResizeListener","_templateObject2","title","classMap","dark","dark_mode","_fitMap","changedProps","has","size","oldHass","get","_iteratorNormalCompletion","_didIteratorError","_iteratorError","_step","_iterator","Symbol","iterator","done","entity","states","root","shadowRoot","getElementById","isPanel","paddingBottom","_drawEntities","updateMap","_callee2","_ref2","_context2","_slicedToArray","oldConfig","zoom","default_zoom","_mapItems","bounds","latLngBounds","item","getLatLng","fitBounds","pad","getZoom","setZoom","LatLng","latitude","longitude","forEach","marker","mapItems","_mapZones","mapZones","allEntities","includesAll","includes","_i2","_Object$keys","keys","stateObj","computeDomain","attributes","source","push","_iteratorNormalCompletion2","_didIteratorError2","_iteratorError2","_step2","_iterator2","computeStateName","_stateObj$attributes","passive","icon","radius","entity_picture","gpsAccuracy","gps_accuracy","computeStateDomain","part","join","divIcon","iconSize","className","circle","interactive","color","iconHTML","el","outerHTML","innerHTML","addLayer","_this3","ResizeObserver","observe","css","_templateObject3","LitElement"],"mappings":"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","file":"chunk.e50a320540a888ecf9e8.js","sourcesContent":["import { dedupingMixin } from \"@polymer/polymer/lib/utils/mixin\";\n\nimport { fireEvent } from \"../common/dom/fire_event\";\n\n// Polymer legacy event helpers used courtesy of the Polymer project.\n//\n// Copyright (c) 2017 The Polymer Authors. All rights reserved.\n//\n// Redistribution and use in source and binary forms, with or without\n// modification, are permitted provided that the following conditions are\n// met:\n//\n//    * Redistributions of source code must retain the above copyright\n// notice, this list of conditions and the following disclaimer.\n//    * Redistributions in binary form must reproduce the above\n// copyright notice, this list of conditions and the following disclaimer\n// in the documentation and/or other materials provided with the\n// distribution.\n//    * Neither the name of Google Inc. nor the names of its\n// contributors may be used to endorse or promote products derived from\n// this software without specific prior written permission.\n//\n// THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS\n// \"AS IS\" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT\n// LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR\n// A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT\n// OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,\n// SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT\n// LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE,\n// DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY\n// THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT\n// (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE\n// OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\n\n/* @polymerMixin */\nexport const EventsMixin = dedupingMixin(\n  (superClass) =>\n    class extends superClass {\n      /**\n   * Dispatches a custom event with an optional detail value.\n   *\n   * @param {string} type Name of event type.\n   * @param {*=} detail Detail value containing event-specific\n   *   payload.\n   * @param {{ bubbles: (boolean|undefined),\n               cancelable: (boolean|undefined),\n                composed: (boolean|undefined) }=}\n    *  options Object specifying options.  These may include:\n    *  `bubbles` (boolean, defaults to `true`),\n    *  `cancelable` (boolean, defaults to false), and\n    *  `node` on which to fire the event (HTMLElement, defaults to `this`).\n    * @return {Event} The new event that was fired.\n    */\n      fire(type, detail, options) {\n        options = options || {};\n        return fireEvent(options.node || this, type, detail, options);\n      }\n    }\n);\n","import { Map } from \"leaflet\";\n\n// Sets up a Leaflet map on the provided DOM element\nexport type LeafletModuleType = typeof import(\"leaflet\");\nexport type LeafletDrawModuleType = typeof import(\"leaflet-draw\");\n\nexport const setupLeafletMap = async (\n  mapElement: HTMLElement,\n  darkMode = false,\n  draw = false\n): Promise<[Map, LeafletModuleType]> => {\n  if (!mapElement.parentNode) {\n    throw new Error(\"Cannot setup Leaflet map on disconnected element\");\n  }\n  // tslint:disable-next-line\n  const Leaflet = (await import(\n    /* webpackChunkName: \"leaflet\" */ \"leaflet\"\n  )) as LeafletModuleType;\n  Leaflet.Icon.Default.imagePath = \"/static/images/leaflet/images/\";\n\n  if (draw) {\n    await import(/* webpackChunkName: \"leaflet-draw\" */ \"leaflet-draw\");\n  }\n\n  const map = Leaflet.map(mapElement);\n  const style = document.createElement(\"link\");\n  style.setAttribute(\"href\", \"/static/images/leaflet/leaflet.css\");\n  style.setAttribute(\"rel\", \"stylesheet\");\n  mapElement.parentNode.appendChild(style);\n  map.setView([52.3731339, 4.8903147], 13);\n  createTileLayer(Leaflet, darkMode).addTo(map);\n\n  return [map, Leaflet];\n};\n\nexport const createTileLayer = (\n  leaflet: LeafletModuleType,\n  darkMode: boolean\n) => {\n  return leaflet.tileLayer(\n    `https://{s}.basemaps.cartocdn.com/${\n      darkMode ? \"dark_all\" : \"light_all\"\n    }/{z}/{x}/{y}${leaflet.Browser.retina ? \"@2x.png\" : \".png\"}`,\n    {\n      attribution:\n        '&copy; <a href=\"https://www.openstreetmap.org/copyright\">OpenStreetMap</a>, &copy; <a href=\"https://carto.com/attributions\">CARTO</a>',\n      subdomains: \"abcd\",\n      minZoom: 0,\n      maxZoom: 20,\n    }\n  );\n};\n","/**\n@license\nCopyright (c) 2016 The Polymer Project Authors. All rights reserved.\nThis code may only be used under the BSD style license found at http://polymer.github.io/LICENSE.txt\nThe complete set of authors may be found at http://polymer.github.io/AUTHORS.txt\nThe complete set of contributors may be found at http://polymer.github.io/CONTRIBUTORS.txt\nCode distributed by Google as part of the polymer project is also\nsubject to an additional IP rights grant found at http://polymer.github.io/PATENTS.txt\n*/\nimport '@polymer/polymer/polymer-legacy.js';\n\nimport {Polymer} from '@polymer/polymer/lib/legacy/polymer-fn.js';\nimport {html} from '@polymer/polymer/lib/utils/html-tag.js';\nimport {resolveUrl} from '@polymer/polymer/lib/utils/resolve-url.js';\n\n/**\n`iron-image` is an element for displaying an image that provides useful sizing and\npreloading options not found on the standard `<img>` tag.\n\nThe `sizing` option allows the image to be either cropped (`cover`) or\nletterboxed (`contain`) to fill a fixed user-size placed on the element.\n\nThe `preload` option prevents the browser from rendering the image until the\nimage is fully loaded.  In the interim, either the element's CSS `background-color`\ncan be be used as the placeholder, or the `placeholder` property can be\nset to a URL (preferably a data-URI, for instant rendering) for an\nplaceholder image.\n\nThe `fade` option (only valid when `preload` is set) will cause the placeholder\nimage/color to be faded out once the image is rendered.\n\nExamples:\n\n  Basically identical to `<img src=\"...\">` tag:\n\n    <iron-image src=\"http://lorempixel.com/400/400\"></iron-image>\n\n  Will letterbox the image to fit:\n\n    <iron-image style=\"width:400px; height:400px;\" sizing=\"contain\"\n      src=\"http://lorempixel.com/600/400\"></iron-image>\n\n  Will crop the image to fit:\n\n    <iron-image style=\"width:400px; height:400px;\" sizing=\"cover\"\n      src=\"http://lorempixel.com/600/400\"></iron-image>\n\n  Will show light-gray background until the image loads:\n\n    <iron-image style=\"width:400px; height:400px; background-color: lightgray;\"\n      sizing=\"cover\" preload src=\"http://lorempixel.com/600/400\"></iron-image>\n\n  Will show a base-64 encoded placeholder image until the image loads:\n\n    <iron-image style=\"width:400px; height:400px;\" placeholder=\"data:image/gif;base64,...\"\n      sizing=\"cover\" preload src=\"http://lorempixel.com/600/400\"></iron-image>\n\n  Will fade the light-gray background out once the image is loaded:\n\n    <iron-image style=\"width:400px; height:400px; background-color: lightgray;\"\n      sizing=\"cover\" preload fade src=\"http://lorempixel.com/600/400\"></iron-image>\n\nCustom property | Description | Default\n----------------|-------------|----------\n`--iron-image-placeholder` | Mixin applied to #placeholder | `{}`\n`--iron-image-width` | Sets the width of the wrapped image | `auto`\n`--iron-image-height` | Sets the height of the wrapped image | `auto`\n\n@group Iron Elements\n@element iron-image\n@demo demo/index.html\n*/\nPolymer({\n  _template: html`\n    <style>\n      :host {\n        display: inline-block;\n        overflow: hidden;\n        position: relative;\n      }\n\n      #baseURIAnchor {\n        display: none;\n      }\n\n      #sizedImgDiv {\n        position: absolute;\n        top: 0px;\n        right: 0px;\n        bottom: 0px;\n        left: 0px;\n\n        display: none;\n      }\n\n      #img {\n        display: block;\n        width: var(--iron-image-width, auto);\n        height: var(--iron-image-height, auto);\n      }\n\n      :host([sizing]) #sizedImgDiv {\n        display: block;\n      }\n\n      :host([sizing]) #img {\n        display: none;\n      }\n\n      #placeholder {\n        position: absolute;\n        top: 0px;\n        right: 0px;\n        bottom: 0px;\n        left: 0px;\n\n        background-color: inherit;\n        opacity: 1;\n\n        @apply --iron-image-placeholder;\n      }\n\n      #placeholder.faded-out {\n        transition: opacity 0.5s linear;\n        opacity: 0;\n      }\n    </style>\n\n    <a id=\"baseURIAnchor\" href=\"#\"></a>\n    <div id=\"sizedImgDiv\" role=\"img\" hidden$=\"[[_computeImgDivHidden(sizing)]]\" aria-hidden$=\"[[_computeImgDivARIAHidden(alt)]]\" aria-label$=\"[[_computeImgDivARIALabel(alt, src)]]\"></div>\n    <img id=\"img\" alt$=\"[[alt]]\" hidden$=\"[[_computeImgHidden(sizing)]]\" crossorigin$=\"[[crossorigin]]\" on-load=\"_imgOnLoad\" on-error=\"_imgOnError\">\n    <div id=\"placeholder\" hidden$=\"[[_computePlaceholderHidden(preload, fade, loading, loaded)]]\" class$=\"[[_computePlaceholderClassName(preload, fade, loading, loaded)]]\"></div>\n`,\n\n  is: 'iron-image',\n\n  properties: {\n    /**\n     * The URL of an image.\n     */\n    src: {type: String, value: ''},\n\n    /**\n     * A short text alternative for the image.\n     */\n    alt: {type: String, value: null},\n\n    /**\n     * CORS enabled images support:\n     * https://developer.mozilla.org/en-US/docs/Web/HTML/CORS_enabled_image\n     */\n    crossorigin: {type: String, value: null},\n\n    /**\n     * When true, the image is prevented from loading and any placeholder is\n     * shown.  This may be useful when a binding to the src property is known to\n     * be invalid, to prevent 404 requests.\n     */\n    preventLoad: {type: Boolean, value: false},\n\n    /**\n     * Sets a sizing option for the image.  Valid values are `contain` (full\n     * aspect ratio of the image is contained within the element and\n     * letterboxed) or `cover` (image is cropped in order to fully cover the\n     * bounds of the element), or `null` (default: image takes natural size).\n     */\n    sizing: {type: String, value: null, reflectToAttribute: true},\n\n    /**\n     * When a sizing option is used (`cover` or `contain`), this determines\n     * how the image is aligned within the element bounds.\n     */\n    position: {type: String, value: 'center'},\n\n    /**\n     * When `true`, any change to the `src` property will cause the\n     * `placeholder` image to be shown until the new image has loaded.\n     */\n    preload: {type: Boolean, value: false},\n\n    /**\n     * This image will be used as a background/placeholder until the src image\n     * has loaded.  Use of a data-URI for placeholder is encouraged for instant\n     * rendering.\n     */\n    placeholder: {type: String, value: null, observer: '_placeholderChanged'},\n\n    /**\n     * When `preload` is true, setting `fade` to true will cause the image to\n     * fade into place.\n     */\n    fade: {type: Boolean, value: false},\n\n    /**\n     * Read-only value that is true when the image is loaded.\n     */\n    loaded: {notify: true, readOnly: true, type: Boolean, value: false},\n\n    /**\n     * Read-only value that tracks the loading state of the image when the\n     * `preload` option is used.\n     */\n    loading: {notify: true, readOnly: true, type: Boolean, value: false},\n\n    /**\n     * Read-only value that indicates that the last set `src` failed to load.\n     */\n    error: {notify: true, readOnly: true, type: Boolean, value: false},\n\n    /**\n     * Can be used to set the width of image (e.g. via binding); size may also\n     * be set via CSS.\n     */\n    width: {observer: '_widthChanged', type: Number, value: null},\n\n    /**\n     * Can be used to set the height of image (e.g. via binding); size may also\n     * be set via CSS.\n     *\n     * @attribute height\n     * @type number\n     * @default null\n     */\n    height: {observer: '_heightChanged', type: Number, value: null},\n  },\n\n  observers: [\n    '_transformChanged(sizing, position)',\n    '_loadStateObserver(src, preventLoad)'\n  ],\n\n  created: function() {\n    this._resolvedSrc = '';\n  },\n\n  _imgOnLoad: function() {\n    if (this.$.img.src !== this._resolveSrc(this.src)) {\n      return;\n    }\n\n    this._setLoading(false);\n    this._setLoaded(true);\n    this._setError(false);\n  },\n\n  _imgOnError: function() {\n    if (this.$.img.src !== this._resolveSrc(this.src)) {\n      return;\n    }\n\n    this.$.img.removeAttribute('src');\n    this.$.sizedImgDiv.style.backgroundImage = '';\n\n    this._setLoading(false);\n    this._setLoaded(false);\n    this._setError(true);\n  },\n\n  _computePlaceholderHidden: function() {\n    return !this.preload || (!this.fade && !this.loading && this.loaded);\n  },\n\n  _computePlaceholderClassName: function() {\n    return (this.preload && this.fade && !this.loading && this.loaded) ?\n        'faded-out' :\n        '';\n  },\n\n  _computeImgDivHidden: function() {\n    return !this.sizing;\n  },\n\n  _computeImgDivARIAHidden: function() {\n    return this.alt === '' ? 'true' : undefined;\n  },\n\n  _computeImgDivARIALabel: function() {\n    if (this.alt !== null) {\n      return this.alt;\n    }\n\n    // Polymer.ResolveUrl.resolveUrl will resolve '' relative to a URL x to\n    // that URL x, but '' is the default for src.\n    if (this.src === '') {\n      return '';\n    }\n\n    // NOTE: Use of `URL` was removed here because IE11 doesn't support\n    // constructing it. If this ends up being problematic, we should\n    // consider reverting and adding the URL polyfill as a dev dependency.\n    var resolved = this._resolveSrc(this.src);\n    // Remove query parts, get file name.\n    return resolved.replace(/[?|#].*/g, '').split('/').pop();\n  },\n\n  _computeImgHidden: function() {\n    return !!this.sizing;\n  },\n\n  _widthChanged: function() {\n    this.style.width = isNaN(this.width) ? this.width : this.width + 'px';\n  },\n\n  _heightChanged: function() {\n    this.style.height = isNaN(this.height) ? this.height : this.height + 'px';\n  },\n\n  _loadStateObserver: function(src, preventLoad) {\n    var newResolvedSrc = this._resolveSrc(src);\n    if (newResolvedSrc === this._resolvedSrc) {\n      return;\n    }\n\n    this._resolvedSrc = '';\n    this.$.img.removeAttribute('src');\n    this.$.sizedImgDiv.style.backgroundImage = '';\n\n    if (src === '' || preventLoad) {\n      this._setLoading(false);\n      this._setLoaded(false);\n      this._setError(false);\n    } else {\n      this._resolvedSrc = newResolvedSrc;\n      this.$.img.src = this._resolvedSrc;\n      this.$.sizedImgDiv.style.backgroundImage =\n          'url(\"' + this._resolvedSrc + '\")';\n\n      this._setLoading(true);\n      this._setLoaded(false);\n      this._setError(false);\n    }\n  },\n\n  _placeholderChanged: function() {\n    this.$.placeholder.style.backgroundImage =\n        this.placeholder ? 'url(\"' + this.placeholder + '\")' : '';\n  },\n\n  _transformChanged: function() {\n    var sizedImgDivStyle = this.$.sizedImgDiv.style;\n    var placeholderStyle = this.$.placeholder.style;\n\n    sizedImgDivStyle.backgroundSize = placeholderStyle.backgroundSize =\n        this.sizing;\n\n    sizedImgDivStyle.backgroundPosition = placeholderStyle.backgroundPosition =\n        this.sizing ? this.position : '';\n\n    sizedImgDivStyle.backgroundRepeat = placeholderStyle.backgroundRepeat =\n        this.sizing ? 'no-repeat' : '';\n  },\n\n  _resolveSrc: function(testSrc) {\n    var resolved = resolveUrl(testSrc, this.$.baseURIAnchor.href);\n    // NOTE: Use of `URL` was removed here because IE11 doesn't support\n    // constructing it. If this ends up being problematic, we should\n    // consider reverting and adding the URL polyfill as a dev dependency.\n    if (resolved.length >= 2 && resolved[0] === '/' && resolved[1] !== '/') {\n      // In IE location.origin might not work\n      // https://connect.microsoft.com/IE/feedback/details/1763802/location-origin-is-undefined-in-ie-11-on-windows-10-but-works-on-windows-7\n      resolved = (location.origin || location.protocol + '//' + location.host) +\n          resolved;\n    }\n    return resolved;\n  }\n});\n","import \"@polymer/iron-image/iron-image\";\nimport { html } from \"@polymer/polymer/lib/utils/html-tag\";\nimport { PolymerElement } from \"@polymer/polymer/polymer-element\";\n\nimport { EventsMixin } from \"../../mixins/events-mixin\";\n\n/*\n * @appliesMixin EventsMixin\n */\nclass HaEntityMarker extends EventsMixin(PolymerElement) {\n  static get template() {\n    return html`\n      <style include=\"iron-positioning\"></style>\n      <style>\n        .marker {\n          vertical-align: top;\n          position: relative;\n          display: block;\n          margin: 0 auto;\n          width: 2.5em;\n          text-align: center;\n          height: 2.5em;\n          line-height: 2.5em;\n          font-size: 1.5em;\n          border-radius: 50%;\n          border: 0.1em solid\n            var(--ha-marker-color, var(--default-primary-color));\n          color: rgb(76, 76, 76);\n          background-color: white;\n        }\n        iron-image {\n          border-radius: 50%;\n        }\n      </style>\n\n      <div class=\"marker\">\n        <template is=\"dom-if\" if=\"[[entityName]]\"\n          >[[entityName]]</template\n        >\n        <template is=\"dom-if\" if=\"[[entityPicture]]\">\n          <iron-image\n            sizing=\"cover\"\n            class=\"fit\"\n            src=\"[[entityPicture]]\"\n          ></iron-image>\n        </template>\n      </div>\n    `;\n  }\n\n  static get properties() {\n    return {\n      hass: {\n        type: Object,\n      },\n\n      entityId: {\n        type: String,\n        value: \"\",\n      },\n\n      entityName: {\n        type: String,\n        value: null,\n      },\n\n      entityPicture: {\n        type: String,\n        value: null,\n      },\n    };\n  }\n\n  ready() {\n    super.ready();\n    this.addEventListener(\"click\", (ev) => this.badgeTap(ev));\n  }\n\n  badgeTap(ev) {\n    ev.stopPropagation();\n    if (this.entityId) {\n      this.fire(\"hass-more-info\", { entityId: this.entityId });\n    }\n  }\n}\n\ncustomElements.define(\"ha-entity-marker\", HaEntityMarker);\n","// Handle 16x9, 16:9, 1.78x1, 1.78:1, 1.78\n// Ignore everything else\nconst parseOrThrow = (num) => {\n  const parsed = parseFloat(num);\n  if (isNaN(parsed)) {\n    throw new Error(`${num} is not a number`);\n  }\n  return parsed;\n};\n\nexport default function parseAspectRatio(input: string) {\n  if (!input) {\n    return null;\n  }\n  try {\n    if (input.endsWith(\"%\")) {\n      return { w: 100, h: parseOrThrow(input.substr(0, input.length - 1)) };\n    }\n\n    const arr = input.replace(\":\", \"x\").split(\"x\");\n    if (arr.length === 0) {\n      return null;\n    }\n\n    return arr.length === 1\n      ? { w: parseOrThrow(arr[0]), h: 1 }\n      : { w: parseOrThrow(arr[0]), h: parseOrThrow(arr[1]) };\n  } catch (err) {\n    // Ignore the error\n  }\n  return null;\n}\n","import \"@polymer/paper-icon-button/paper-icon-button\";\nimport { Layer, Marker, Circle, Map } from \"leaflet\";\nimport {\n  LitElement,\n  TemplateResult,\n  css,\n  html,\n  property,\n  PropertyValues,\n  CSSResult,\n  customElement,\n} from \"lit-element\";\n\nimport \"../../map/ha-entity-marker\";\n\nimport {\n  setupLeafletMap,\n  createTileLayer,\n  LeafletModuleType,\n} from \"../../../common/dom/setup-leaflet-map\";\nimport { computeStateDomain } from \"../../../common/entity/compute_state_domain\";\nimport { computeStateName } from \"../../../common/entity/compute_state_name\";\nimport { debounce } from \"../../../common/util/debounce\";\nimport parseAspectRatio from \"../../../common/util/parse-aspect-ratio\";\nimport { computeDomain } from \"../../../common/entity/compute_domain\";\n\nimport { HomeAssistant } from \"../../../types\";\nimport { LovelaceCard } from \"../types\";\nimport { EntityConfig } from \"../entity-rows/types\";\nimport { processConfigEntities } from \"../common/process-config-entities\";\nimport { MapCardConfig } from \"./types\";\nimport { classMap } from \"lit-html/directives/class-map\";\nimport { LovelaceConfig } from \"../../../data/lovelace\";\nimport { findEntities } from \"../common/find-entites\";\n\n@customElement(\"hui-map-card\")\nclass HuiMapCard extends LitElement implements LovelaceCard {\n  public static async getConfigElement() {\n    await import(\n      /* webpackChunkName: \"hui-map-card-editor\" */ \"../editor/config-elements/hui-map-card-editor\"\n    );\n    return document.createElement(\"hui-map-card-editor\");\n  }\n\n  public static getStubConfig(\n    hass: HomeAssistant,\n    lovelaceConfig: LovelaceConfig,\n    entities?: string[],\n    entitiesFill?: string[]\n  ): object {\n    const includeDomains = [\"device_tracker\"];\n    const maxEntities = 2;\n    const foundEntities = findEntities(\n      hass,\n      lovelaceConfig,\n      maxEntities,\n      entities,\n      entitiesFill,\n      includeDomains\n    );\n\n    return { entities: foundEntities };\n  }\n\n  @property() public hass?: HomeAssistant;\n\n  @property({ type: Boolean, reflect: true })\n  public isPanel = false;\n\n  @property()\n  private _config?: MapCardConfig;\n  private _configEntities?: EntityConfig[];\n  // tslint:disable-next-line\n  private Leaflet?: LeafletModuleType;\n  private _leafletMap?: Map;\n  // @ts-ignore\n  private _resizeObserver?: ResizeObserver;\n  private _debouncedResizeListener = debounce(\n    () => {\n      if (!this._leafletMap) {\n        return;\n      }\n      this._leafletMap.invalidateSize();\n    },\n    100,\n    false\n  );\n  private _mapItems: Array<Marker | Circle> = [];\n  private _mapZones: Array<Marker | Circle> = [];\n  private _connected = false;\n\n  public setConfig(config: MapCardConfig): void {\n    if (!config) {\n      throw new Error(\"Error in card configuration.\");\n    }\n\n    if (!config.entities && !config.geo_location_sources) {\n      throw new Error(\n        \"Either entities or geo_location_sources must be defined\"\n      );\n    }\n    if (config.entities && !Array.isArray(config.entities)) {\n      throw new Error(\"Entities need to be an array\");\n    }\n    if (\n      config.geo_location_sources &&\n      !Array.isArray(config.geo_location_sources)\n    ) {\n      throw new Error(\"Geo_location_sources needs to be an array\");\n    }\n\n    this._config = config;\n    this._configEntities = config.entities\n      ? processConfigEntities(config.entities)\n      : [];\n  }\n\n  public getCardSize(): number {\n    if (!this._config) {\n      return 3;\n    }\n    const ratio = parseAspectRatio(this._config.aspect_ratio);\n    const ar =\n      ratio && ratio.w > 0 && ratio.h > 0\n        ? `${((100 * ratio.h) / ratio.w).toFixed(2)}`\n        : \"100\";\n    return 1 + Math.floor(Number(ar) / 25) || 3;\n  }\n\n  public connectedCallback(): void {\n    super.connectedCallback();\n    this._connected = true;\n    if (this.hasUpdated) {\n      this.loadMap();\n      this._attachObserver();\n    }\n  }\n\n  public disconnectedCallback(): void {\n    super.disconnectedCallback();\n    this._connected = false;\n\n    if (this._leafletMap) {\n      this._leafletMap.remove();\n      this._leafletMap = undefined;\n      this.Leaflet = undefined;\n    }\n\n    if (this._resizeObserver) {\n      this._resizeObserver.unobserve(this._mapEl);\n    } else {\n      window.removeEventListener(\"resize\", this._debouncedResizeListener);\n    }\n  }\n\n  protected render(): TemplateResult {\n    if (!this._config) {\n      return html``;\n    }\n    return html`\n      <ha-card id=\"card\" .header=${this._config.title}>\n        <div id=\"root\">\n          <div\n            id=\"map\"\n            class=${classMap({ dark: this._config.dark_mode === true })}\n          ></div>\n          <paper-icon-button\n            @click=${this._fitMap}\n            tabindex=\"0\"\n            icon=\"hass:image-filter-center-focus\"\n            title=\"Reset focus\"\n          ></paper-icon-button>\n        </div>\n      </ha-card>\n    `;\n  }\n\n  protected shouldUpdate(changedProps) {\n    if (!changedProps.has(\"hass\") || changedProps.size > 1) {\n      return true;\n    }\n\n    const oldHass = changedProps.get(\"hass\") as HomeAssistant | undefined;\n\n    if (!oldHass || !this._configEntities) {\n      return true;\n    }\n\n    // Check if any state has changed\n    for (const entity of this._configEntities) {\n      if (oldHass.states[entity.entity] !== this.hass!.states[entity.entity]) {\n        return true;\n      }\n    }\n\n    return false;\n  }\n\n  protected firstUpdated(changedProps: PropertyValues): void {\n    super.firstUpdated(changedProps);\n    this.loadMap();\n    const root = this.shadowRoot!.getElementById(\"root\");\n\n    if (!this._config || this.isPanel || !root) {\n      return;\n    }\n\n    if (this._connected) {\n      this._attachObserver();\n    }\n\n    const ratio = parseAspectRatio(this._config.aspect_ratio);\n\n    root.style.paddingBottom =\n      ratio && ratio.w > 0 && ratio.h > 0\n        ? `${((100 * ratio.h) / ratio.w).toFixed(2)}%`\n        : (root.style.paddingBottom = \"100%\");\n  }\n\n  protected updated(changedProps: PropertyValues): void {\n    if (changedProps.has(\"hass\")) {\n      this._drawEntities();\n      this._fitMap();\n    }\n    if (\n      changedProps.has(\"_config\") &&\n      changedProps.get(\"_config\") !== undefined\n    ) {\n      this.updateMap(changedProps.get(\"_config\") as MapCardConfig);\n    }\n  }\n\n  private get _mapEl(): HTMLDivElement {\n    return this.shadowRoot!.getElementById(\"map\") as HTMLDivElement;\n  }\n\n  private async loadMap(): Promise<void> {\n    [this._leafletMap, this.Leaflet] = await setupLeafletMap(\n      this._mapEl,\n      this._config !== undefined ? this._config.dark_mode === true : false\n    );\n    this._drawEntities();\n    this._leafletMap.invalidateSize();\n    this._fitMap();\n  }\n\n  private updateMap(oldConfig: MapCardConfig): void {\n    const map = this._leafletMap;\n    const config = this._config;\n    const Leaflet = this.Leaflet;\n    if (!map || !config || !Leaflet) {\n      return;\n    }\n    if (config.dark_mode !== oldConfig.dark_mode) {\n      createTileLayer(Leaflet, config.dark_mode === true).addTo(map);\n    }\n    if (\n      config.entities !== oldConfig.entities ||\n      config.geo_location_sources !== oldConfig.geo_location_sources\n    ) {\n      this._drawEntities();\n    }\n    map.invalidateSize();\n    this._fitMap();\n  }\n\n  private _fitMap(): void {\n    if (!this._leafletMap || !this.Leaflet || !this._config || !this.hass) {\n      return;\n    }\n    const zoom = this._config.default_zoom;\n    if (this._mapItems.length === 0) {\n      this._leafletMap.setView(\n        new this.Leaflet.LatLng(\n          this.hass.config.latitude,\n          this.hass.config.longitude\n        ),\n        zoom || 14\n      );\n      return;\n    }\n\n    const bounds = this.Leaflet.latLngBounds(\n      this._mapItems ? this._mapItems.map((item) => item.getLatLng()) : []\n    );\n    this._leafletMap.fitBounds(bounds.pad(0.5));\n\n    if (zoom && this._leafletMap.getZoom() > zoom) {\n      this._leafletMap.setZoom(zoom);\n    }\n  }\n\n  private _drawEntities(): void {\n    const hass = this.hass;\n    const map = this._leafletMap;\n    const config = this._config;\n    const Leaflet = this.Leaflet;\n    if (!hass || !map || !config || !Leaflet) {\n      return;\n    }\n\n    if (this._mapItems) {\n      this._mapItems.forEach((marker) => marker.remove());\n    }\n    const mapItems: Layer[] = (this._mapItems = []);\n\n    if (this._mapZones) {\n      this._mapZones.forEach((marker) => marker.remove());\n    }\n    const mapZones: Layer[] = (this._mapZones = []);\n\n    const allEntities = this._configEntities!.concat();\n\n    // Calculate visible geo location sources\n    if (config.geo_location_sources) {\n      const includesAll = config.geo_location_sources.includes(\"all\");\n      for (const entityId of Object.keys(hass.states)) {\n        const stateObj = hass.states[entityId];\n        if (\n          computeDomain(entityId) === \"geo_location\" &&\n          (includesAll ||\n            config.geo_location_sources.includes(stateObj.attributes.source))\n        ) {\n          allEntities.push({ entity: entityId });\n        }\n      }\n    }\n\n    for (const entity of allEntities) {\n      const entityId = entity.entity;\n      const stateObj = hass.states[entityId];\n      if (!stateObj) {\n        continue;\n      }\n      const title = computeStateName(stateObj);\n      const {\n        latitude,\n        longitude,\n        passive,\n        icon,\n        radius,\n        entity_picture: entityPicture,\n        gps_accuracy: gpsAccuracy,\n      } = stateObj.attributes;\n\n      if (!(latitude && longitude)) {\n        continue;\n      }\n\n      if (computeStateDomain(stateObj) === \"zone\") {\n        // DRAW ZONE\n        if (passive) {\n          continue;\n        }\n\n        // create icon\n        let iconHTML = \"\";\n        if (icon) {\n          const el = document.createElement(\"ha-icon\");\n          el.setAttribute(\"icon\", icon);\n          iconHTML = el.outerHTML;\n        } else {\n          const el = document.createElement(\"span\");\n          el.innerHTML = title;\n          iconHTML = el.outerHTML;\n        }\n\n        // create marker with the icon\n        mapZones.push(\n          Leaflet.marker([latitude, longitude], {\n            icon: Leaflet.divIcon({\n              html: iconHTML,\n              iconSize: [24, 24],\n              className: this._config!.dark_mode === true ? \"dark\" : \"light\",\n            }),\n            interactive: false,\n            title,\n          })\n        );\n\n        // create circle around it\n        mapZones.push(\n          Leaflet.circle([latitude, longitude], {\n            interactive: false,\n            color: \"#FF9800\",\n            radius,\n          })\n        );\n\n        continue;\n      }\n\n      // DRAW ENTITY\n      // create icon\n      const entityName = title\n        .split(\" \")\n        .map((part) => part[0])\n        .join(\"\")\n        .substr(0, 3);\n\n      // create market with the icon\n      mapItems.push(\n        Leaflet.marker([latitude, longitude], {\n          icon: Leaflet.divIcon({\n            // Leaflet clones this element before adding it to the map. This messes up\n            // our Polymer object and we can't pass data through. Thus we hack like this.\n            html: `\n              <ha-entity-marker\n                entity-id=\"${entityId}\"\n                entity-name=\"${entityName}\"\n                entity-picture=\"${entityPicture || \"\"}\"\n              ></ha-entity-marker>\n            `,\n            iconSize: [48, 48],\n            className: \"\",\n          }),\n          title: computeStateName(stateObj),\n        })\n      );\n\n      // create circle around if entity has accuracy\n      if (gpsAccuracy) {\n        mapItems.push(\n          Leaflet.circle([latitude, longitude], {\n            interactive: false,\n            color: \"#0288D1\",\n            radius: gpsAccuracy,\n          })\n        );\n      }\n    }\n\n    this._mapItems.forEach((marker) => map.addLayer(marker));\n    this._mapZones.forEach((marker) => map.addLayer(marker));\n  }\n\n  private _attachObserver(): void {\n    // Observe changes to map size and invalidate to prevent broken rendering\n    // Uses ResizeObserver in Chrome, otherwise window resize event\n\n    // @ts-ignore\n    if (typeof ResizeObserver === \"function\") {\n      // @ts-ignore\n      this._resizeObserver = new ResizeObserver(() =>\n        this._debouncedResizeListener()\n      );\n      this._resizeObserver.observe(this._mapEl);\n    } else {\n      window.addEventListener(\"resize\", this._debouncedResizeListener);\n    }\n  }\n\n  static get styles(): CSSResult {\n    return css`\n      :host([ispanel]) ha-card {\n        left: 0;\n        top: 0;\n        width: 100%;\n        /**\n       * In panel mode we want a full height map. Since parent #view\n       * only sets min-height, we need absolute positioning here\n       */\n        height: 100%;\n        position: absolute;\n      }\n\n      ha-card {\n        overflow: hidden;\n      }\n\n      #map {\n        z-index: 0;\n        border: none;\n        position: absolute;\n        top: 0;\n        left: 0;\n        width: 100%;\n        height: 100%;\n        background: #fafaf8;\n      }\n\n      #map.dark {\n        background: #090909;\n      }\n\n      paper-icon-button {\n        position: absolute;\n        top: 75px;\n        left: 7px;\n      }\n\n      #root {\n        position: relative;\n      }\n\n      :host([ispanel]) #root {\n        height: 100%;\n      }\n\n      .dark {\n        color: #ffffff;\n      }\n\n      .light {\n        color: #000000;\n      }\n    `;\n  }\n}\n\ndeclare global {\n  interface HTMLElementTagNameMap {\n    \"hui-map-card\": HuiMapCard;\n  }\n}\n"],"sourceRoot":""}