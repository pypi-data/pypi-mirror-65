

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>pyexpander reference &mdash; pyexpander 1.10.1 documentation</title>
  

  
  
  
  

  
  <script type="text/javascript" src="_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
        <script type="text/javascript" src="_static/jquery.js"></script>
        <script type="text/javascript" src="_static/underscore.js"></script>
        <script type="text/javascript" src="_static/doctools.js"></script>
        <script type="text/javascript" src="_static/language_data.js"></script>
    
    <script type="text/javascript" src="_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="EPICS support in pyexpander" href="epics-support.html" />
    <link rel="prev" title="Introduction to pyexpander" href="introduction.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="index.html" class="icon icon-home"> pyexpander
          

          
          </a>

          
            
            
              <div class="version">
                1.10.1
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="introduction.html">Introduction to pyexpander</a><ul>
<li class="toctree-l2"><a class="reference internal" href="introduction.html#macro-substitution">Macro substitution</a></li>
</ul>
</li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">pyexpander reference</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#a-note-on-python-versions">A note on Python versions</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#short-version">Short version</a></li>
<li class="toctree-l3"><a class="reference internal" href="#background">Background</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#syntax-of-the-pyexpander-language">Syntax of the pyexpander language</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#the-meaning-of-the-dollar-sign">The meaning of the dollar sign</a></li>
<li class="toctree-l3"><a class="reference internal" href="#comments">Comments</a></li>
<li class="toctree-l3"><a class="reference internal" href="#commands">Commands</a></li>
<li class="toctree-l3"><a class="reference internal" href="#executing-python-statements">Executing python statements</a></li>
<li class="toctree-l3"><a class="reference internal" href="#line-continuation">Line continuation</a></li>
<li class="toctree-l3"><a class="reference internal" href="#substitutions">Substitutions</a></li>
<li class="toctree-l3"><a class="reference internal" href="#default-values-for-variables">Default values for variables</a></li>
<li class="toctree-l3"><a class="reference internal" href="#variable-scopes">Variable scopes</a></li>
<li class="toctree-l3"><a class="reference internal" href="#extending-the-pyexpander-language">Extending the pyexpander language</a></li>
<li class="toctree-l3"><a class="reference internal" href="#conditionals">Conditionals</a></li>
<li class="toctree-l3"><a class="reference internal" href="#while-loops">While loops</a></li>
<li class="toctree-l3"><a class="reference internal" href="#for-loops">For loops</a></li>
<li class="toctree-l3"><a class="reference internal" href="#macros">macros</a></li>
<li class="toctree-l3"><a class="reference internal" href="#include-files">Include files</a></li>
<li class="toctree-l3"><a class="reference internal" href="#safe-mode">Safe mode</a></li>
<li class="toctree-l3"><a class="reference internal" href="#commands-for-epics-macro-substitution">Commands for EPICS macro substitution</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#internals">Internals</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#pyexpander-parser">pyexpander.parser</a></li>
<li class="toctree-l3"><a class="reference internal" href="#pyexpander-lib">pyexpander.lib</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#scripts-provided-by-the-package">Scripts provided by the package</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#expander-py">expander.py</a></li>
<li class="toctree-l3"><a class="reference internal" href="#msi2pyexpander-py">msi2pyexpander.py</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="epics-support.html">EPICS support in pyexpander</a><ul>
<li class="toctree-l2"><a class="reference internal" href="epics-support.html#setting-the-name-of-the-template-file">Setting the name of the template file</a></li>
<li class="toctree-l2"><a class="reference internal" href="epics-support.html#the-subst-command">The “subst” command</a></li>
<li class="toctree-l2"><a class="reference internal" href="epics-support.html#the-pattern-command">The “pattern” command</a></li>
<li class="toctree-l2"><a class="reference internal" href="epics-support.html#differences-to-the-epics-msi-tool">Differences to the EPICS msi tool</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="python3.html">pyexpander for users not familiar with python version 3</a><ul>
<li class="toctree-l2"><a class="reference internal" href="python3.html#introduction">Introduction</a></li>
<li class="toctree-l2"><a class="reference internal" href="python3.html#comments">Comments</a></li>
<li class="toctree-l2"><a class="reference internal" href="python3.html#a-word-on-indentation">A word on indentation</a></li>
<li class="toctree-l2"><a class="reference internal" href="python3.html#defining-variables">Defining variables</a><ul>
<li class="toctree-l3"><a class="reference internal" href="python3.html#literals">Literals</a></li>
<li class="toctree-l3"><a class="reference internal" href="python3.html#setting-more-than-one-variable">Setting more than one variable</a></li>
<li class="toctree-l3"><a class="reference internal" href="python3.html#simple-expressions">Simple expressions</a></li>
<li class="toctree-l3"><a class="reference internal" href="python3.html#mathematical-functions">Mathematical functions</a></li>
<li class="toctree-l3"><a class="reference internal" href="python3.html#string-expressions">String expressions</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="python3.html#for-loops">For loops</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="expander-options.html">expander.py and expander2.py command line options</a><ul>
<li class="toctree-l2"><a class="reference internal" href="expander-options.html#h"><code class="docutils literal notranslate"><span class="pre">-h</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="expander-options.html#summary"><code class="docutils literal notranslate"><span class="pre">--summary</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="expander-options.html#f-file-file-file"><code class="docutils literal notranslate"><span class="pre">-f</span> <span class="pre">FILE</span> <span class="pre">--file</span> <span class="pre">FILE</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="expander-options.html#encoding"><code class="docutils literal notranslate"><span class="pre">--encoding</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="expander-options.html#output-encoding"><code class="docutils literal notranslate"><span class="pre">--output-encoding</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="expander-options.html#eval"><code class="docutils literal notranslate"><span class="pre">--eval</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="expander-options.html#i-path-include-path"><code class="docutils literal notranslate"><span class="pre">-I</span> <span class="pre">PATH</span> <span class="pre">--include</span> <span class="pre">PATH</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="expander-options.html#s-simple-vars"><code class="docutils literal notranslate"><span class="pre">-s</span> <span class="pre">--simple-vars</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="expander-options.html#a-auto-continuation"><code class="docutils literal notranslate"><span class="pre">-a</span> <span class="pre">--auto-continuation</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="expander-options.html#i-auto-indent"><code class="docutils literal notranslate"><span class="pre">-i</span> <span class="pre">--auto-indent</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="expander-options.html#no-stdin-msg"><code class="docutils literal notranslate"><span class="pre">--no-stdin-msg</span></code></a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="msi2pyexpander-options.html">msi2pyexpander.py and msi2pyexpander2.py command line options</a><ul>
<li class="toctree-l2"><a class="reference internal" href="msi2pyexpander-options.html#h"><code class="docutils literal notranslate"><span class="pre">-h</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="msi2pyexpander-options.html#summary"><code class="docutils literal notranslate"><span class="pre">--summary</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="msi2pyexpander-options.html#s-substitutionfile"><code class="docutils literal notranslate"><span class="pre">-S</span> <span class="pre">--substitutionfile</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="msi2pyexpander-options.html#o-file-outputfile-file"><code class="docutils literal notranslate"><span class="pre">-o</span> <span class="pre">FILE</span> <span class="pre">--outputfile</span> <span class="pre">FILE</span></code></a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="pyexpander-install.html">Installing pyexpander</a><ul>
<li class="toctree-l2"><a class="reference internal" href="pyexpander-install.html#parts-of-pyexpander">Parts of pyexpander</a></li>
<li class="toctree-l2"><a class="reference internal" href="pyexpander-install.html#requirements">Requirements</a></li>
<li class="toctree-l2"><a class="reference internal" href="pyexpander-install.html#install-from-pypi-with-pip">Install from pypi with pip</a></li>
<li class="toctree-l2"><a class="reference internal" href="pyexpander-install.html#install-from-a-debian-package">Install from a debian package</a></li>
<li class="toctree-l2"><a class="reference internal" href="pyexpander-install.html#install-from-a-rpm-package">Install from a rpm package</a></li>
<li class="toctree-l2"><a class="reference internal" href="pyexpander-install.html#install-from-source-tar-gz-or-zip-file">Install from source (tar.gz or zip file)</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="pyexpander-install-by-setup.html">Installing pyexpander by running setup.py</a><ul>
<li class="toctree-l2"><a class="reference internal" href="pyexpander-install-by-setup.html#install-from-source-tar-gz-or-zip-file">Install from source (tar.gz or zip file)</a><ul>
<li class="toctree-l3"><a class="reference internal" href="pyexpander-install-by-setup.html#install-as-root-to-default-directories">Install as root to default directories</a></li>
<li class="toctree-l3"><a class="reference internal" href="pyexpander-install-by-setup.html#install-to-a-separate-directory">Install to a separate directory</a></li>
<li class="toctree-l3"><a class="reference internal" href="pyexpander-install-by-setup.html#install-in-your-home">Install in your home</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="modules.html">python2</a><ul>
<li class="toctree-l2"><a class="reference internal" href="pyexpander.html">pyexpander package</a><ul>
<li class="toctree-l3"><a class="reference internal" href="pyexpander.html#submodules">Submodules</a></li>
<li class="toctree-l3"><a class="reference internal" href="pyexpander.html#module-pyexpander.lib">pyexpander.lib module</a></li>
<li class="toctree-l3"><a class="reference internal" href="pyexpander.html#module-pyexpander.parser">pyexpander.parser module</a></li>
<li class="toctree-l3"><a class="reference internal" href="pyexpander.html#module-pyexpander">Module contents</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="license.html">pyexpander license</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">pyexpander</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="index.html">Docs</a> &raquo;</li>
        
      <li>pyexpander reference</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="_sources/reference-expander.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="pyexpander-reference">
<h1>pyexpander reference<a class="headerlink" href="#pyexpander-reference" title="Permalink to this headline">¶</a></h1>
<div class="section" id="a-note-on-python-versions">
<h2>A note on Python versions<a class="headerlink" href="#a-note-on-python-versions" title="Permalink to this headline">¶</a></h2>
<div class="section" id="short-version">
<h3>Short version<a class="headerlink" href="#short-version" title="Permalink to this headline">¶</a></h3>
<p>Python 2 support in pyexpander is deprecated. Python 2 will not be supported in
future versions of the program.</p>
<p>If you don’t already use pyexpander, or don’t know the python language, simply
install the python 3 version of pyexpander. The program that does macro
substitutions is called “expander.py”.</p>
<p>If you need, for backwards compatibility, the python 2 version of pyexpander,
the program that does macro substitutions is called “expander2.py”.</p>
</div>
<div class="section" id="background">
<h3>Background<a class="headerlink" href="#background" title="Permalink to this headline">¶</a></h3>
<p>Currently there exist two major branches of the python language, python version
2 and python version 3. Both have slight differences in syntax and not all
programs are compatible with both versions.</p>
<p>Pyexpander comes for now in a python 2 and a python 3 version. You can install one of
these versions or both at the same time. In order to distinguish the versions,
the expander script is named “expander2.py” for the python 2 version, and
“expander.py” for the python 3 version.</p>
<p>Note that embedded python code like in the <code class="docutils literal notranslate"><span class="pre">py(...)</span></code> statement must use the
same major python version as the one pyexpander uses. So if you installed
pyexpander for python 3 your embedded python code must also be in the python 3
dialect. The same applies for python 2.</p>
<p>Python 2 support is deprecated, future versions of pyexpander will not support
python 2.</p>
</div>
</div>
<div class="section" id="syntax-of-the-pyexpander-language">
<h2>Syntax of the pyexpander language<a class="headerlink" href="#syntax-of-the-pyexpander-language" title="Permalink to this headline">¶</a></h2>
<div class="section" id="the-meaning-of-the-dollar-sign">
<h3>The meaning of the dollar sign<a class="headerlink" href="#the-meaning-of-the-dollar-sign" title="Permalink to this headline">¶</a></h3>
<p>Almost all elements of the language start with a dollar “$” sign. If a dollar
is preceded by a backslash “&quot; it is escaped. The “\$” is then replaced with
a simple dollar character “$” and the rules described further down do not
apply.</p>
<p>Here is an example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>an escaped dollar: \$
</pre></div>
</div>
<p>This would produce this output:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>an escaped dollar: $
</pre></div>
</div>
</div>
<div class="section" id="comments">
<h3>Comments<a class="headerlink" href="#comments" title="Permalink to this headline">¶</a></h3>
<p>A comment is started by a sequence “$#” where the dollar sign is not preceded
by a backslash (see above). All characters until and including the end of line
character(s) are ignored. Here is an example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>This is ordinary text, $# from here it is a comment
here the text continues.
</pre></div>
</div>
</div>
<div class="section" id="commands">
<h3>Commands<a class="headerlink" href="#commands" title="Permalink to this headline">¶</a></h3>
<p>If the dollar sign, which is not preceded by a backslash, is followed by a
letter or an underline “_” and one or more alphanumeric characters, including
the underline “_”, it is interpreted to be an expander command.</p>
<p>The <em>name</em> of the command consists of all alphanumeric characters including “_”
that follow. In order to be able to embed commands into a sequence of letters,
as a variant of this, the <em>name</em> may be enclosed in curly brackets. This
variant is only allowed for commands that do not expect parameters.</p>
<p>If the command expects parameters, an opening round bracket “(” must
immediately (without spaces) follow the characters of the command name. The
parameters end with a closing round bracket “)”.</p>
<p>Here are some examples:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>this is not a command due to escaping rules: \$mycommand
a command: $begin
a command within a sequence of letters abc${begin}def
a command with parameters: $for(x in range(0,3))
</pre></div>
</div>
<p>Note that in the last line, since the parameter of the “for” command must be a
valid python expression, all opening brackets in that expression must match a
closing bracket. By this rule pyexpander is able to find the closing bracket
that belongs to the opening bracket of the parameter list.</p>
</div>
<div class="section" id="executing-python-statements">
<h3>Executing python statements<a class="headerlink" href="#executing-python-statements" title="Permalink to this headline">¶</a></h3>
<p>A statement may be any valid python code. Statements usually do not return
values. All expressions are statements, but not all statements are
expressions. In order to execute python statements, there is the “py” command.
“py” is an abbreviation of python. This command expects that valid python code
follows enclosed in brackets. Note that the closing bracket for “py” <em>must not</em>
be in the same line with a python comment, since a python comment would include
the bracket and all characters until the end of the line, leading to a
pyexpander parser error. The “py” command leads to the execution of the python
code but produces no output. It is usually used to define variables, but it can
also be used to execute python code of more complexity. Here are some
examples:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>Here we define the variable &quot;x&quot; to be 1: $py(x=1)
Here we define two variables at a time: $py(x=1;y=2)
Here we define a function, note that we have to keep
the indentation that python requires intact:
$py(
def multiply(x,y):
    return x*y
    # here is a python comment
    # note that the closing bracket below
    # *MUST NOT* be in such a comment line
   )
</pre></div>
</div>
</div>
<div class="section" id="line-continuation">
<h3>Line continuation<a class="headerlink" href="#line-continuation" title="Permalink to this headline">¶</a></h3>
<p>Since the end of line character is never part of a command, commands placed on
a single line would produce an empty line in the output. Since this is
sometimes not wanted, the generation of an empty line can be suppressed by
ending the line with a single backslash “&quot;. Here is an example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$py(x=1;y=2)\
The value of x is $(x), the value of y is $(y).
Note that no leading empty line is generated in this example.
</pre></div>
</div>
<p>If you have an application that would always require backslashes at the end of
commands you can start the expander script with option “-a”. This has the same
effect as appending a backslash to each line that ends with a command. See also
<a class="reference internal" href="expander-options.html"><span class="doc">expander.py and expander2.py command line options</span></a>.</p>
<p>So with “-a” you expander script does not have to look look like this:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$py(
a=True
)\
Here is a conditional:
$if(a)\
a was True
$else\
a was False
$endif\
</pre></div>
</div>
<p>but like this:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$py(
a=True
)
Here is a conditional:
$if(a)
a was True
$else
a was False
$endif
</pre></div>
</div>
</div>
<div class="section" id="substitutions">
<h3>Substitutions<a class="headerlink" href="#substitutions" title="Permalink to this headline">¶</a></h3>
<p>A substitution consists of a dollar “$” that is not preceded by a backslash and
followed by an opening round bracket “(” and a matching closing round bracket
“)”. The string enclosed by the pair of brackets must form a valid python
expression. Note that a python expression, in opposition to a python statement,
always has a value. This value is converted to a string and this string is
inserted in the text in place of the substitution command. Here is an example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$py(x=2) we set &quot;x&quot; to 2 here
now we can replace &quot;x&quot; anywhere in the text
like here $(x) since &quot;x&quot; alone is already a python expression.
Note that the argument of &quot;py&quot; is a python statement.
We can also insert x times 3 here like this: $(x*3).
We can even do calculations like: $(x*sin(x)).
</pre></div>
</div>
<p>There is also a mode called “simple vars” in the expander tool, where the round
brackets around variable names may be omitted. Note that this is not possible
for arbitrary python expressions, since pyexpander would not know where the
expression ends without the brackets. Here is an example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>We define x: $py(x=1)
In &quot;simple vars&quot; mode, we can use the variable as we know
it: $(x) but also without brackets: $x. However, expressions that are
not simple variable names must still use brackets: $(x*2).
</pre></div>
</div>
</div>
<div class="section" id="default-values-for-variables">
<h3>Default values for variables<a class="headerlink" href="#default-values-for-variables" title="Permalink to this headline">¶</a></h3>
<p>When an undefined variable is encountered, pyexpander raises a python exception
and stops. Sometimes however, we want to take a default value for a variable
but only if it has not yet been set with a value. This can be achieved with the
“default” command.  This command must be followed by an opening bracket and an
arbitrary list of named python parameters. This means that each parameter
definition consists of an unquoted name, a “=” and a quoted string, several
parameter definitions must be separated by commas. The “default” command takes
these parameters and sets the variables of these names to the given values if
the variables are not yet set with different values. Here is an example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>We define a: $py(a=1)
Now we set a default for a and b: $default(a=10, b=20)
Here, $(a) is 1 since is was already defined before
and $(b) is 20, it&#39;s default value since it was not defined before.
</pre></div>
</div>
</div>
<div class="section" id="variable-scopes">
<h3>Variable scopes<a class="headerlink" href="#variable-scopes" title="Permalink to this headline">¶</a></h3>
<p>By default, all variables defined in a “py” command are global. They exist from
the first time they are mentioned in the text and can be modified at any place
further below.  Sometimes however, it is desirable to set a variable in a
certain area of the text and restore it to it’s old value below that area. In
order to do this, variable scopes are used. A variable scope starts with a
“begin” command and ends with an “end” command. All variable definitions and
changes between “begin” and “end” are reverted when the “end” command is
reached. Some commands like “for”, “while” and “include” have a variant with a
“_begin” appended to their name, where they behave like “begin” and “end” and
define a variable scope additionally to their normal function. Here is an
example of “begin” and “end”:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$py(a=1)
a is now 1
$begin
$py(a=2)
a is now 2
$end
here, a is 1 again
</pre></div>
</div>
<p>All variable modifications and definitions within a variable scope are isolated
from the rest of the text. However, sometimes we want to modify variables
outside the scope. This can be done by declaring a variable as non-local with
the command “nonlocal”. The “nonlocal” command must be followed by a comma
separated list of variable names enclosed in brackets. When the end of the
scope is reached, all variables that were declared non-local are copied to the
outer scope. Here is an example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$py(a=1;b=2;c=3)
a is now 1, b is 2 and c is 3
$begin
$nonlocal(a,b)
$py(a=10;b=20;c=30)
a is now 10, b is 20 and c is 30
$end
here, a is 10, b is 20 and c is 3 again
</pre></div>
</div>
<p>If scopes are nested, the “nonlocal” defines a variable to be non-local only in
the current scope. If the current scope is left, the variable is local again
unless it is defined non-local in that scope, too.</p>
</div>
<div class="section" id="extending-the-pyexpander-language">
<h3>Extending the pyexpander language<a class="headerlink" href="#extending-the-pyexpander-language" title="Permalink to this headline">¶</a></h3>
<p>All functions or variables defined in a “$py” command have to be applied in the
text by enclosing them in brackets and prepending a dollar sign like here:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$(myvar)
$(myfunction(parameters))
</pre></div>
</div>
<p>However, sometimes it would be nice if we could use these python objects a bit
easier. This can be achieved with the “extend” or the “extend_expr” command.
“extend” expects to be followed by a comma separated list of identifiers
enclosed in brackets. “extend_expr” must be followed by a python expression
that is an iterable of strings. The identifiers can then be used in the text
without the need to enclose them in brackets. Here is an example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$extend(myvar,myfunction)
$myvar
$myfunction(parameters)
</pre></div>
</div>
<p>Note that identifiers extend the pyexpander language local to their scope. Here
is an example for this:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$py(a=1)
$begin
$extend(a)
we can use &quot;a&quot; here directly like $a
$end
here the &quot;extend&quot; is unknown, a has always
to be enclosed in brackets like $(a)
</pre></div>
</div>
<p>You should note that with respect to the “extend” command, there is a
difference between including a file with the “include” command or the
“include_begin” command (described further below). The latter one defines a
new scope, and the rule shown above applies here, too.</p>
</div>
<div class="section" id="conditionals">
<h3>Conditionals<a class="headerlink" href="#conditionals" title="Permalink to this headline">¶</a></h3>
<p>A conditional part consists at least of an “if” and an “endif” command. Between
these two there may be an arbitrary number of “elif” commands. Before “endif”
and after the last “elif” (if present) there may be an “else” command. “if” and
“elif” are followed by a condition expression, enclosed in round brackets.
“else” and “endif” do not have parameters. If the condition after “if” is true,
this part is evaluated. If it is false, the next “elif” part is tested. If it
is true, this part is evaluated, if not, the next “elif” part is tested and so
on. If no matching condition was found, the “else” part is evaluated. All of
this is oriented on the python language which also has “if”,”elif” and “else”.
“endif” has no counterpart in python since there the indentation shows where
the block ends. Here is an example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>We set x to 1; $py(x=1)
$if(x&gt;2)
x is bigger than 2
$elif(x&gt;1)
x is bigger than 1
$elif(x==1)
x is equal to 1
$else
x is smaller than 1
$endif
here is a classical if-else-endif:
$if(x&gt;0)
x is bigger than 0
$else
x is not bigger than 0
$endif
here is a simple if-endif:
$if(x==0)
x is zero
$endif
</pre></div>
</div>
</div>
<div class="section" id="while-loops">
<h3>While loops<a class="headerlink" href="#while-loops" title="Permalink to this headline">¶</a></h3>
<p>While loops are used to generate text that contains almost identical
repetitions of text fragments. The loop continues while the given loop
condition is true. A While loop starts with a “while” command followed by a
boolean expression enclosed in brackets. The end of the loop is marked by a
“endwhile” statement. Here is an example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$py(a=3)
$while(a&gt;0)
a is now: $(a)
$py(a-=1)
$endwhile
</pre></div>
</div>
<p>In this example the loop runs 3 times with values of a ranging from 3 to 1.</p>
<p>The command “while_begin” combines a while loop with a scope:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$while_begin(condition)
...
$endwhile
</pre></div>
</div>
<p>and:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$while(condition)
$begin
...
$end
$endwhile
</pre></div>
</div>
<p>are equivalent.</p>
</div>
<div class="section" id="for-loops">
<h3>For loops<a class="headerlink" href="#for-loops" title="Permalink to this headline">¶</a></h3>
<p>For loops are a powerful tool to generate text that contains almost identical
repetitions of text fragments. A “for” command expects a parameter that is a
python expression in the form “variable(s) in iterable”. For each run the
variable is set to another value from the iterable and the following text is
evaluated until “endfor” is found. At “endfor”, pyexpander jumps back to the
“for” statement and assigns the next value to the variable. Here is an
example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$for(x in range(0,5))
x is now: $(x)
$endfor
</pre></div>
</div>
<p>The range function in python generates a list of integers starting with 0 and
ending with 4 in this example.</p>
<p>You can also have more than one loop variable:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$for( (x,y) in [(x,x*x) for x in range(0,3)])
x:$(x) y:$(y)
$endfor
</pre></div>
</div>
<p>or you can iterate over keys and values of a python dictionary:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$py(d={&quot;A&quot;:1, &quot;B&quot;:2, &quot;C&quot;:3})
$for( (k,v) in d.items())
key: $(k) value: $(v)
$endfor
</pre></div>
</div>
<p>The command “for_begin” combines a for loop with a scope:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$for_begin(loop expression)
...
$endfor
</pre></div>
</div>
<p>and:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$for(loop expression)
$begin
...
$end
$endfor
</pre></div>
</div>
<p>are equivalent.</p>
</div>
<div class="section" id="macros">
<h3>macros<a class="headerlink" href="#macros" title="Permalink to this headline">¶</a></h3>
<p>Macros provide a way to group parts of your scripts and reuse them at other
places. Macros can have arguments that provide values when the macro is
instantiated. You can think of a macro as a way to copy and paste a part of
your script to a different location. Note that a macro invocation must always
be followed by a pair of brackets, even if the macro doesn’t get any arguments.</p>
<p>Here is an example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$macro(snippet)
This is a macro that just
adds some text.
$endmacro
\
$macro(underline, line)
$(line)
$(&quot;-&quot; * len(line))
$endmacro
\
$underline(&quot;My heading&quot;)
$snippet()
</pre></div>
</div>
<p>If you run this with expander.py or expander2.py with option -a (see
<a class="reference internal" href="#line-continuation">Line continuation</a>), this is the output:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">My</span> <span class="n">heading</span>
<span class="o">----------</span>
<span class="n">This</span> <span class="ow">is</span> <span class="n">a</span> <span class="n">macro</span> <span class="n">that</span> <span class="n">just</span>
<span class="n">adds</span> <span class="n">some</span> <span class="n">text</span><span class="o">.</span>
</pre></div>
</div>
<p>Arguments to macros are given the same way as in python, except you cannot use
default values for arguments.</p>
<p>With option -i (see <a class="reference internal" href="expander-options.html"><span class="doc">expander.py and expander2.py command line options</span></a>) pyexpander indents lines according to the row where the macro invocation was placed. Here is an example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$macro(subsnippet)
This is another
snippet.
$endmacro
\
$macro(snippet)
This is a macro that just
adds some text and contains
a subsnippet from here
    $subsnippet()
to here.
Snippet end.
$endmacro
\
$macro(underline, line)
$(line)
$(&quot;-&quot; * len(line))
$endmacro
\
$underline(&quot;My heading&quot;)
    $snippet()
</pre></div>
</div>
<p>If you run this with expander.py or expander2.py with option -a and -i,
you get the following output:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">My</span> <span class="n">heading</span>
<span class="o">----------</span>
    <span class="n">This</span> <span class="ow">is</span> <span class="n">a</span> <span class="n">macro</span> <span class="n">that</span> <span class="n">just</span>
    <span class="n">adds</span> <span class="n">some</span> <span class="n">text</span> <span class="ow">and</span> <span class="n">contains</span>
    <span class="n">a</span> <span class="n">subsnippet</span> <span class="kn">from</span> <span class="nn">here</span>
        <span class="n">This</span> <span class="ow">is</span> <span class="n">another</span>
        <span class="n">snippet</span><span class="o">.</span>
    <span class="n">to</span> <span class="n">here</span><span class="o">.</span>
    <span class="n">Snippet</span> <span class="n">end</span><span class="o">.</span>
</pre></div>
</div>
<p>As you see, the text of the macro has the same indentation level as the macro
itself. This is also true for macros that contain other macros.</p>
</div>
<div class="section" id="include-files">
<h3>Include files<a class="headerlink" href="#include-files" title="Permalink to this headline">¶</a></h3>
<p>The “include” command is used to include a file at the current position. It
must be followed by one string or two strings (or string expressions) enclosed
in brackets.</p>
<p>The first string is always a filename, the optional second string is the
encoding of the file, e.g. “utf-8” or “iso8859-1”. Valid encoding names can be
looked up here:</p>
<p><a class="reference external" href="https://docs.python.org/3/library/codecs.html#standard-encodings">python encodings</a>.</p>
<p>The given file is then interpreted until the end of the file is reached, then
the interpretation of the text continues after the “include” command in the
original text.</p>
<p>Here is an example without an explicit encoding:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$include(&quot;additional_defines.inc&quot;)
</pre></div>
</div>
<p>and here is an example for an iso8859 encoded include file:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$include(&quot;additional_defines-iso.inc&quot;, &quot;iso8859&quot;)
</pre></div>
</div>
<p>The command “include_begin” combines an include with a scope. It is equivalent
to the case when the include file starts with a “begin” command and ends with
an “end” command.</p>
<p>Here is an example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$include_begin(&quot;additional_defines.inc&quot;)
</pre></div>
</div>
</div>
<div class="section" id="safe-mode">
<h3>Safe mode<a class="headerlink" href="#safe-mode" title="Permalink to this headline">¶</a></h3>
<p>The “safemode” command enables restrictions on commands. You start the safe
mode like this:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$safemode
</pre></div>
</div>
<p>The following features of pyexpander are disabled in safe mode and stop the
program:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>- ``$(EXPRESSION)``
- ``$py(...)``
- ``$extend(...)``
- ``$extend_expr(...)``
</pre></div>
</div>
<p>Note that <code class="docutils literal notranslate"><span class="pre">$(VARIABLENAME)</span></code> can still be used.</p>
<p>The safe mode can only be switched on, there is no command to switch it off. It
is, however, only active within the current variable scope (see <a class="reference internal" href="#variable-scopes">Variable
scopes</a>) as shown here:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$begin
$safemode
$# here safemode is on
$end
$# here safemode is off
</pre></div>
</div>
</div>
<div class="section" id="commands-for-epics-macro-substitution">
<h3>Commands for EPICS macro substitution<a class="headerlink" href="#commands-for-epics-macro-substitution" title="Permalink to this headline">¶</a></h3>
<p><a class="reference external" href="http://www.aps.anl.gov/epics">EPICS</a> is a framework for building control
systems. pyexpander has three more commands for this application, that
are described here:</p>
<p><a class="reference internal" href="epics-support.html"><span class="doc">EPICS support in pyexpander</span></a>.</p>
</div>
</div>
<div class="section" id="internals">
<h2>Internals<a class="headerlink" href="#internals" title="Permalink to this headline">¶</a></h2>
<p>This section describes how pyexpander works.</p>
<p>pyexpander consists of the following parts:</p>
<div class="section" id="pyexpander-parser">
<h3>pyexpander.parser<a class="headerlink" href="#pyexpander-parser" title="Permalink to this headline">¶</a></h3>
<p>A python module that implements a parser for expander files. This is the
library that defines all functions and classes the are used for
pyexpander.</p>
<p>Here is a link to the <a class="reference internal" href="pyexpander.html#module-pyexpander.parser" title="pyexpander.parser"><code class="xref py py-mod docutils literal notranslate"><span class="pre">pyexpander.parser</span></code></a>.</p>
</div>
<div class="section" id="pyexpander-lib">
<h3>pyexpander.lib<a class="headerlink" href="#pyexpander-lib" title="Permalink to this headline">¶</a></h3>
<p>A python module that implements all the functions needed to
implement the pyexpander language.</p>
<p>Here is a link to the <a class="reference internal" href="pyexpander.html#module-pyexpander.lib" title="pyexpander.lib"><code class="xref py py-mod docutils literal notranslate"><span class="pre">pyexpander.lib</span></code></a>.</p>
</div>
</div>
<div class="section" id="scripts-provided-by-the-package">
<h2>Scripts provided by the package<a class="headerlink" href="#scripts-provided-by-the-package" title="Permalink to this headline">¶</a></h2>
<div class="section" id="expander-py">
<h3>expander.py<a class="headerlink" href="#expander-py" title="Permalink to this headline">¶</a></h3>
<p>This script is used for macro substitution in text files. They have
command line options for search paths and file names and use pyexpander
to interpret the given text file.</p>
<p>You will probably just use one of these for your application. However, you
could write a python program yourself that imports and uses the pyexpander
library.</p>
<p>Here is a link to the <a class="reference external" href="expander-options.html">expander.py command line options</a>.</p>
<p>Note that if you installed the python 2 version of pyexpander, this script is
called “expander2.py” instead. (Note that python 2 support is deprecated).</p>
</div>
<div class="section" id="msi2pyexpander-py">
<h3>msi2pyexpander.py<a class="headerlink" href="#msi2pyexpander-py" title="Permalink to this headline">¶</a></h3>
<p>This script is used to convert <a class="reference external" href="http://www.aps.anl.gov/epics">EPICS</a> <a class="reference external" href="http://www.aps.anl.gov/epics/extensions/msi/index.php">msi</a> template files to the
format of pyexpander. You only need this script when you have an <a class="reference external" href="http://www.aps.anl.gov/epics">EPICS</a> application and want to start using pyexpander
for it.</p>
<p>Here is a link to the <a class="reference external" href="msi2pyexpander-options.html">command line options of msi2pyexpander.py</a>.</p>
<p>Note that if you installed the python 2 version of pyexpander, this script is
called “msi2pyexpander2.py” instead. (Also note that python 2 support is
deprecated).</p>
</div>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="epics-support.html" class="btn btn-neutral float-right" title="EPICS support in pyexpander" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="introduction.html" class="btn btn-neutral float-left" title="Introduction to pyexpander" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2020, Helmholtz-Zentrum Berlin GmbH

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>