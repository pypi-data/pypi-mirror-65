!function(t){function e(e){for(var n,l,r=e[0],s=e[1],c=e[2],h=0,g=[];h<r.length;h++)l=r[h],a[l]&&g.push(a[l][0]),a[l]=0;for(n in s)Object.prototype.hasOwnProperty.call(s,n)&&(t[n]=s[n]);for(d&&d(e);g.length;)g.shift()();return o.push.apply(o,c||[]),i()}function i(){for(var t,e=0;e<o.length;e++){for(var i=o[e],n=!0,r=1;r<i.length;r++){var s=i[r];0!==a[s]&&(n=!1)}n&&(o.splice(e--,1),t=l(l.s=i[0]))}return t}var n={},a={144:0},o=[];function l(e){if(n[e])return n[e].exports;var i=n[e]={i:e,l:!1,exports:{}};return t[e].call(i.exports,i,i.exports,l),i.l=!0,i.exports}l.e=function(){return Promise.resolve()},l.m=t,l.c=n,l.d=function(t,e,i){l.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:i})},l.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},l.t=function(t,e){if(1&e&&(t=l(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var i=Object.create(null);if(l.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var n in t)l.d(i,n,function(e){return t[e]}.bind(null,n));return i},l.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return l.d(e,"a",e),e},l.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},l.p="/dist/";var r=window.coreJsonp=window.coreJsonp||[],s=r.push.bind(r);r.push=e,r=r.slice();for(var c=0;c<r.length;c++)e(r[c]);var d=s;o.push([1685,0]),i()}({1685:function(t,e,i){t.exports=i(1686)},1686:function(t,e,i){(function(t){!function(e){"use strict";var i,n,a,o,l,r=!1,s=-1,c=!1,d={},h={},g=null,u={},f=null,p=null,m=!1,v=$T.gettext("The back side of the templates that use this one as the back side will be removed."),b=$T.gettext("Disassociate back sides"),k=!1,w=50;function x(t){return t*l}function _(t){return t/l}function y(t,e){return t(/([0-9.]+)pt/g.exec(e)[1])+"pt"}var j=t.partial(y,x),T=t.partial(y,x);function C(t){var e={id:++s,type:t,x:a,y:o,font_family:"sans-serif",bold:!1,italic:!1,text_align:"center",color:"black",font_size:"15pt",width:"ticket_qr_code"===t?150:400,height:"ticket_qr_code"===t?150:null,text:$T("Fixed text"),selected:!1};return e.toHTML=function(){return $("<div>").addClass("designer-item").toggleClass("selected",this.selected).css({width:x(this.width),height:this.height?x(this.height):this.height,cursor:"move",fontWeight:this.bold?"bold":"normal",fontStyle:this.italic?"italic":"normal",fontFamily:this.font_family,fontSize:j(this.font_size),textAlign:this.text_align.replace("Justified","justify"),color:this.color}).attr("data-type",this.type).text("fixed"===this.type?this.text:u[this.type])}.bind(e),e}function M(t,e){this.realWidth=t,this.realHeight=e,this.width=x(t),this.height=x(e)}function z(t,e){var i=e?".template-side.back":".template-side.front",n=$("<div/>").css({position:"absolute",left:t.x+"px",top:t.y+"px",zIndex:s+10}).data("id",t.id).appendTo(i);return e?n:(n.draggable({containment:i,stack:i+" > div",opacity:.5,drag:function(t,e){r&&(e.position.left=10*Math.floor(e.position.left/10),e.position.top=10*Math.floor(e.position.top/10))},stop:function(t,e){var i=$(this).data("id");d[i].x=_(e.position.left),d[i].y=_(e.position.top)}}),n)}function O(t,e){if(t.length){var i=t.closest(".ui-draggable").data("id");return e?h[i]:d[i]}}function D(){return O($(".designer-item.selected"))}function P(t){var e=O(t);e&&(e.selected=!1,t.removeClass("selected"))}function q(e){var i=O(e);$(".element-tools").removeClass("hidden"),$(".second-row").removeClass("disappear"),$(".selection-text").html("fixed"===i.type?$T.gettext("Fixed text"):u[i.type]),P($(".designer-item.selected")),i.selected=!0,e.addClass("selected");var n=t.filter([i.bold?"bold":null,i.italic?"italic":null]);$("#alignment-selector").val(i.text_align),$("#font-selector").val(i.font_family),$("#size-selector").val(i.font_size),$("#style-selector").val(n.length?n.join("_"):"normal"),$("#color-selector").val(i.color),$(".js-element-width").val(i.width/a);var o=$("#fixed-text-field"),l=$(".font-tools");"fixed"===i.type?(l.fadeIn(),o.closest(".tool").fadeIn(),o.val(i.text)):"ticket_qr_code"===i.type?(l.fadeOut(),o.closest(".tool").fadeOut()):(l.fadeIn(),o.closest(".tool").fadeOut(),o.val(""))}function I(){var t,e=Math.ceil(n.width/a),o=Math.ceil(i.width/a),l=Math.ceil(n.height/a),r=Math.ceil(i.height/a);if(i.width>n.width){var s=$("#horizontal-ruler");for(t=e;t<o;t++)$('<div class="marking"/>').attr("id","rulerh"+t).css({width:a+"px",left:t*a+"px",top:0}).html(t+1).appendTo(s)}else if(i.width<n.width)for(t=e;t>o;t--)$("#rulerh"+(t-1)).remove();if(i.height>n.height){var c=$("#vertical-ruler");for(t=l;t<r;t++)$('<div class="marking"/>').attr("id","rulerv"+t).css({"line-height":a/2+"px",height:a+"px",left:0,top:t*a+"px"}).html(t+1).appendTo(c)}else if(i.height<n.height)for(t=l;t>r;t--)$("#rulerv"+(t-1)).remove()}function S(t,e){var o=$(".template-container"),l=parseFloat($(".template-width").val()),r=parseFloat($(".template-height").val());o.width(Math.round(l*a)),o.height(Math.round(r*a)),n.width=i.width,n.height=i.height,i=new M(Math.round(l*w),Math.round(r*w)),I(),function(t,e){W(t),e.background_url&&W(e,!0)}(t,e),function(t,e){$(".js-preset-tool option").each(function(){var i=$(this);if("custom"!==i.val()){var n=i.data("width"),a=i.data("height");n===t&&a===e&&(i.prop("selected",!0),$(".js-template-dimension").prop("disabled",!0))}})}(l,r)}function F(t){var e=D(),i=$(".designer-item.selected");i&&({font:function(){e.font_family=$("#font-selector").val()},color:function(){e.color=$("#color-selector").val()},alignment:function(){e.text_align=$("#alignment-selector").val()},size:function(){e.font_size=$("#size-selector").val()},style:function(){switch($("#style-selector").val()){case"normal":e.bold=!1,e.italic=!1;break;case"bold":e.bold=!0,e.italic=!1;break;case"italic":e.bold=!1,e.italic=!0;break;case"bold_italic":e.bold=!0,e.italic=!0}},text:function(){var t=$("#fixed-text-field");e.text=t.val().replace(/<\w+(\s+("[^"]*"|'[^']*'|[^>])+)?>|<\/\w+>/gi,"").replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&amp;/g,"&"),t.val(e.text)},width:function(){e.width=Math.round($(".js-element-width").val()*a),"ticket_qr_code"===e.type&&(e.height=e.width)}}[t](),i.replaceWith(e.toHTML()))}function H(t,e){if("stretch"===e)t.css({left:0,top:0}),t.height(i.height),t.width(i.width);else if("center"===e){var n,a=(o=t,(l=new Image).src=o.attr("src"),{width:l.width,height:l.height});t.height(a.height),t.width(a.width),t.width()>i.width||t.height()>i.height?(t.width()>i.width&&(n=i.width/t.width(),t.width(i.width),t.height(t.height()*n),t.css({left:0,top:i.height/2-t.height()/2+"px"})),t.height()>i.height&&(n=i.height/t.height(),t.width(t.width()*n),t.height(i.height),t.css({left:i.width/2-t.width()/2+"px",top:0}))):t.css({left:i.width/2-a.width/2+"px",top:i.height/2-a.height/2+"px"})}var o,l}function W(t,e){var n=e?".template-side.back":".template-side.front",a=$(n).find(".background-image"),o=t.data.background_position;a.attr({src:t.background_url}).css({position:"absolute",left:0,top:0,height:i.height+"px",width:i.width+"px",zIndex:5}).on("load",function(){$("#loadingIcon").hide(),H($(this),o)}).appendTo(n)}function A(e,i){e.data&&(e.data.items.forEach(function(e){!function(e,i){delete e.id;var n=t.extend(C(),e);i?h[n.id]=n:d[n.id]=n}(e,i)}),function(t){var e=t?h:d;$.each(e,function(e,i){var n=z(i,t);n.css({left:x(i.x)+"px",top:x(i.y)+"px"}),n.append(i.toHTML()),i.selected&&!t&&q(n.find(".designer-item"))})}(i)),E(!(i&&e.data&&(e.data.items.length||e.background_url))),e.background_url&&W(e,i)}function L(t){var e=$(".template-side.back");t.background_url&&(t.background_url=null,e.find(".background-image").remove(),e.append($("<img>",{class:"background-image"}))),e.find(".designer-item").remove(),t.title=null,t.data=null,h={}}function E(t){var e=$(".backside-placeholder");e.parent().toggleClass("empty",t),e.toggle(t),$(".backside-tools").toggleClass("hidden",t)}function J(t){E(t),$(".backside-tools").toggleClass("hidden",!t),t?($(".backside-placeholder").addClass("to-be-removed"),$(".placeholder-text").html($T.gettext("This back side template will be removed")),$(".placeholder-link").hide(),v=$T.gettext("The back side of this template will be removed"),b=$T.gettext("Disassociate back side"),k=!0):($(".backside-placeholder").removeClass("to-be-removed"),$(".placeholder-text").html($T.gettext("The back side is empty.")),$(".placeholder-link").show(),v=$T.gettext("The back side of the templates that use this one as the back side will be removed."),b=$T.gettext("Disassociate back sides"),k=!1)}function U(t,e,i,n){if($("#backside-warning").length||null!==g){var a=null;$("#backside-warning").length&&null!==g?a=$(".affected-targets-warning"):$("#backside-warning").length?a=$("#backside-warning"):null!==g&&(a=$("#frontside-warning")),t.val()*w!==i?(null!==g&&J(!0),a.show("fast"),m=!0):e.val()*w===n&&(a.hide("fast"),null!==g&&J(!1),m=!1)}}function N(){$("#frontside-warning").hide("fast"),J(!1),k=!1,m=!1}e.setupDesigner=function(e,s,h,y){c=!!e,u=t.partial(t.extend,{}).apply(null,t.map(t.values(y),t.property("options"))),l=h.zoom_factor,a=x(w),o=a,g=s.id,$(document).ready(function(){var n=$(".js-remove-bg").qtip();$('#bg-form input[type="file"]').on("change",function(){var t=$(this);this.files&&t.next("label").removeClass("i-button").text(this.files[0].name),$(".js-upload-bg").attr("disabled",!t.val()).toggleClass("highlight",!!t.val())}),$(".template-content").on("mousedown",".designer-item",function(){q($(this))}).on("dblclick",".designer-item",function(){!function(t){var e=O(t);if("fixed"===e.type){var i=prompt("Enter fixed-text value",e.text);if(i){var n=t.parent(".ui-draggable");e.text=i,n.html(e.toHTML())}}}($(this))}),$(".js-upload-bg").click(function(){return $(".js-toggle-side.front").click(),$("#bg-form").submit(),!1}),$("#grid-snap").change(function(){r=this.checked}).change(),$("#bg-form").ajaxForm({dataType:"json",iframe:!1,success:function(t){t.error?new AlertPopup($T("Error"),t.error).open():(e.background_url=t.image_url,W(e),$(".template-side.front").trigger("indico:backgroundChanged"))}}),$("input[name=bg-position]").change(function(t){t.preventDefault();var i=$(this).val();H($(".template-side.front .background-image"),i),e.data.background_position=i}),$(".js-remove-bg").click(function(t){t.preventDefault(),n.qtip("api").toggle(),function(t){t.background_url&&(t.background_url=null,$(".template-side.front").trigger("indico:backgroundChanged"))}(e)}),$(".move-button").click(function(t){t.preventDefault(),function(t){var e=D(),n=$(".designer-item.selected").parent();({left:function(){n&&(n.css("left",0),e.x=0)},right:function(){if(n){var t=i.width-n.width();n.css("left",t>0?t+"px":0),e.x=_(t>0?t:0)}},center:function(){if(n){var t=(i.width-n.width())/2,a=(i.height-n.height())/2;n.css("left",t>0?t+"px":0),n.css("top",a>0?a+"px":0),e.x=_(t>0?t:0),e.y=_(a>0?a:0)}},top:function(){n&&(n.css("top",0),e.y=0)},bottom:function(){if(n){var t=i.height-n.height();n.css("top",t>0?t+"px":0),e.y=_(t>0?t:0)}}})[t]()}($(this).data("direction"))}),$(".js-font-tool").change(function(){F($(this).data("attr"))}),$(".insert-element-btn").click(function(t){var e,n,l;t.preventDefault(),$(".js-toggle-side.front").click(),e=C($("#element-list").val()),n=z(e),l=e.toHTML().appendTo(n),d[e.id]=e,q(l),o+=a,o%=i.height-20}),$(".js-remove-element").click(function(t){var e,i;t.preventDefault(),e=$(".designer-item.selected"),(i=D())&&(delete d[i.id],e.remove(),$(".element-tools").addClass("hidden"))}),$(".js-save-template").click(function(n){n.preventDefault(),function(e){if(""!==$(".js-template-name").val())if(Object.keys(d).length||e.background_url){k&&(g=null);var n={template:{width:i.realWidth,height:i.realHeight,background_position:$("input[name=bg-position]:checked").val(),items:t.values(d).map(function(t){return $.extend(!0,{},t).font_size=T(t.font_size),t})},clear_background:!e.background_url,title:$(".js-template-name").val(),is_clonable:$('input[name="is-clonable"]:checked').length>0,backside_template_id:g};(m?confirmPrompt($T.gettext("Are you sure you want to change the dimensions of this template?")+v,b):$.Deferred().resolve()).then(function(){$.ajax({url:location.pathname,data:JSON.stringify(n),contentType:"application/json",method:"POST",complete:IndicoUI.Dialogs.Util.progress(),error:handleAjaxError,success:function(t){f=i.width,p=i.height,k&&($(".affected-targets-warning").hide("fast"),J(!1),$(".js-remove-backside").click(),k=!1,m=!1),handleFlashes(t,!0)}})})}else alertPopup($T.gettext("The template cannot be empty. Add some elements or a background image."),$T.gettext("Warning"));else new AlertPopup($T("Warning"),$T.gettext("Please choose a name for the template")).open()}(e)}),$(".template-width, .template-height").on("input",function(){S(e,s)}),$(".js-element-width").on("keyup click",function(){F("width")}),$("#fixed-text-field").on("keyup",function(){F("text")}),$(".js-preset-tool").on("change",function(){var t=$(this).find("option:selected");"custom"!==t.val()&&($(".template-width").val(t.data("width")).change(),$(".template-height").val(t.data("height")).change(),S(e,s)),$(".js-template-dimension").prop("disabled","custom"!==t.val())}),$(".js-toggle-side").on("click",function(){var t=$(this),e=t.hasClass("front")?"front":"back",i=$(".designer-item.selected"),n=s.data&&(s.data.items.length||s.background_url);$(".template-content").toggleClass("flipped","back"===e),$(".template-side.back").toggleClass("active","back"===e),$(".template-side.front").toggleClass("active","front"===e),$(".backside-tools").toggleClass("hidden","front"===e||!n),$(".js-toggle-side").removeClass("highlight"),$(".element-tools").addClass("hidden"),$(".js-hide-on-flip").toggle("back"!==e),$(".js-invisible-on-flip").toggleClass("disappear","back"===e),t.toggleClass("highlight"),i&&i[0]&&P(i),$(".template-side.active").trigger("indico:backgroundChanged")}),$(".template-side").on("indico:backgroundChanged",function(){var t=$("#backgroundFile"),i=$(".template-side.front"),n=i.find(".background-image");!e.background_url&&n.attr("src")&&(n.remove(),i.append($("<img>",{class:"background"})),t.val(""),t.next("label").addClass("i-button").text($T.gettext("Choose a file"))),$(".js-upload-bg").attr("disabled",!t.val()),$(".js-remove-bg").attr("disabled",!e.background_url),$("#bg-position-stretch").prop("checked","stretch"===e.data.background_position),$("#bg-position-center").prop("checked","center"===e.data.background_position)}),$(".template-side.front").trigger("indico:backgroundChanged"),$(".template-side.back").on("indico:backsideUpdated",function(t,e){g=e.backside_template_id,L(s),A(e.template,!0),s=e.template,k&&N(),$(".backside-template-title, .js-front-affected-title").text(e.template.title)}),$(".js-remove-backside").on("click",function(){g=null,L(s),k&&N(),E(!0)}),$(".js-change-orientation").on("click",function(){var t=$(".template-width"),i=$(".template-height"),n=t.val();t.val(i.val()).change(),i.val(n).change(),S(e,s)}),$(".js-backside-list-dialog").on("click",function(){var t=$(this);ajaxDialog({trigger:t,url:t.data("href"),data:{width:i.realWidth,height:i.realHeight},title:t.data("title")})}),$(".backside-tools").addClass("hidden");var l=$(".template-width"),c=$(".template-height");l.on("change input",function(){U($(this),c,f,p)}),c.on("change input",function(){U($(this),l,p,f)}),$(".js-back-affected").qbubble({overwrite:!0,position:{target:$(".js-back-affected")},content:{text:$(".back-warning-qtip-content").html()},hide:{event:"unfocus click"},show:{event:"click"}}),$(".js-front-affected").qbubble({overwrite:!0,position:{target:$(".js-front-affected")},content:{text:function(){return $(".front-warning-qtip-content").html()}},hide:{event:"unfocus click"},show:{event:"click"}})}),c?(i=new M(e.data.width,e.data.height),$(".js-template-name").val(e.title),$(".js-is-clonable").prop("checked",e.is_clonable),$(".template-container").width(i.width).height(i.height)):i=new M(h.tpl_size[0],h.tpl_size[1]),n=new M(0,0),$(".template-width").val(i.width/a),$(".template-height").val(i.height/a),f=i.width,p=i.height,I(),S(e,s),A(e),A(s,!0)}}(window)}).call(this,i(42))}});
//# sourceMappingURL=module_designer.27c9dff2.bundle.js.map