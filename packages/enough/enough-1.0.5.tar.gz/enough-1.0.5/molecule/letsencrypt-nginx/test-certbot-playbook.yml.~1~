---
- name: setup fake LE
  hosts: all
  become: true

  roles:
    - role: jdauphant.nginx
      vars:
        nginx_sites:
          default:
            - listen 80
            - server_name {{ inventory_hostname }}.{{ domain }}

- name: setup fake LE
  hosts: certbot-host
  become: true

    - role: certbot
      vars:
        with_fake_LE: true
        admins_email: "contact@something.com"
        vhost_fqdn: "{{ inventory_hostname }}.{{ domain }}"

- name: setup real LE
  hosts: bind-host
  become: true

  roles:
    - role: certbot
      vars:
        with_fake_LE: false
        admins_email: "contact@something.com"
        vhost_fqdn: "{{ inventory_hostname }}.{{ domain }}"
