{"version":3,"sources":["webpack:///./src/common/entity/compute_state_name.ts","webpack:///./src/components/ha-icon.ts","webpack:///./src/mixins/localize-mixin.js","webpack:///./src/mixins/events-mixin.js","webpack:///./src/common/entity/compute_state_domain.ts","webpack:///./src/common/entity/compute_object_id.ts","webpack:///./src/common/dom/setup-leaflet-map.ts","webpack:///./src/data/zone.ts","webpack:///./node_modules/@polymer/iron-image/iron-image.js","webpack:///./src/panels/map/ha-entity-marker.js","webpack:///./src/panels/map/ha-panel-map.js"],"names":["__webpack_require__","d","__webpack_exports__","computeStateName","_compute_object_id__WEBPACK_IMPORTED_MODULE_0__","stateObj","undefined","attributes","friendly_name","computeObjectId","entity_id","replace","ironIconClass","customElements","get","loaded","HaIcon","_ironIconClass","_getPrototypeOf2","_this","_classCallCheck","this","_len","arguments","length","args","Array","_key","_getPrototypeOf","call","apply","concat","_assertThisInitialized","_inherits","key","value","node","eventName","methodName","_get","prototype","_iconsetName","e","then","bind","define","dedupingMixin","superClass","_superClass","_class","_possibleConstructorReturn","hass","Object","localize","type","Function","computed","EventsMixin","detail","options","fireEvent","computeStateDomain","_compute_domain__WEBPACK_IMPORTED_MODULE_0__","computeDomain","entityId","substr","indexOf","setupLeafletMap","_ref","regeneratorRuntime","mark","_callee","mapElement","darkMode","draw","Leaflet","map","style","_args","wrap","_context","prev","next","parentNode","Error","t","sent","Icon","Default","imagePath","document","createElement","setAttribute","appendChild","setView","createTileLayer","addTo","abrupt","stop","_x","leaflet","tileLayer","Browser","retina","attribution","subdomains","minZoom","maxZoom","defaultRadiusColor","homeRadiusColor","passiveRadiusColor","fetchZones","createZone","updateZone","deleteZone","showZoneEditor","getZoneEditorInitData","inititialZoneEditorData","_common_navigate__WEBPACK_IMPORTED_MODULE_0__","callWS","values","assign","zoneId","updates","zone_id","el","data","navigate","Polymer","_template","html","_templateObject","is","properties","src","String","alt","crossorigin","preventLoad","Boolean","sizing","reflectToAttribute","position","preload","placeholder","observer","fade","notify","readOnly","loading","error","width","Number","height","observers","created","_resolvedSrc","_imgOnLoad","$","img","_resolveSrc","_setLoading","_setLoaded","_setError","_imgOnError","removeAttribute","sizedImgDiv","backgroundImage","_computePlaceholderHidden","_computePlaceholderClassName","_computeImgDivHidden","_computeImgDivARIAHidden","_computeImgDivARIALabel","split","pop","_computeImgHidden","_widthChanged","isNaN","_heightChanged","_loadStateObserver","newResolvedSrc","_placeholderChanged","_transformChanged","sizedImgDivStyle","placeholderStyle","backgroundSize","backgroundPosition","backgroundRepeat","testSrc","resolved","resolveUrl","baseURIAnchor","href","location","origin","protocol","host","HaEntityMarker","PolymerElement","entityName","entityPicture","entityColor","addEventListener","ev","badgeTap","stopPropagation","fire","HaPanelMap","LocalizeMixin","loadMap","_map","drawEntities","invalidateSize","fitMap","remove","user","is_admin","bounds","_mapItems","LatLng","config","latitude","longitude","latLngBounds","item","getLatLng","fitBounds","pad","forEach","marker","mapItems","_mapZones","mapZones","keys","states","entity","hidden","state","icon","title","passive","iconHTML","outerHTML","innerHTML","divIcon","iconSize","className","push","interactive","circle","color","radius","entity_picture","part","join","gps_accuracy","narrow"],"mappings":"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","file":"chunk.00040d4b184fd20578db.js","sourcesContent":["import { HassEntity } from \"home-assistant-js-websocket\";\nimport { computeObjectId } from \"./compute_object_id\";\n\nexport const computeStateName = (stateObj: HassEntity): string => {\n  return stateObj.attributes.friendly_name === undefined\n    ? computeObjectId(stateObj.entity_id).replace(/_/g, \" \")\n    : stateObj.attributes.friendly_name || \"\";\n};\n","import { Constructor } from \"../types\";\n\nimport \"@polymer/iron-icon/iron-icon\";\n// Not duplicate, this is for typing.\n// tslint:disable-next-line\nimport { IronIconElement } from \"@polymer/iron-icon/iron-icon\";\n\nconst ironIconClass = customElements.get(\"iron-icon\") as Constructor<\n  IronIconElement\n>;\n\nlet loaded = false;\n\nexport class HaIcon extends ironIconClass {\n  private _iconsetName?: string;\n\n  public listen(\n    node: EventTarget | null,\n    eventName: string,\n    methodName: string\n  ): void {\n    super.listen(node, eventName, methodName);\n\n    if (!loaded && this._iconsetName === \"mdi\") {\n      loaded = true;\n      import(/* webpackChunkName: \"mdi-icons\" */ \"../resources/mdi-icons\");\n    }\n  }\n}\n\ndeclare global {\n  interface HTMLElementTagNameMap {\n    \"ha-icon\": HaIcon;\n  }\n}\n\ncustomElements.define(\"ha-icon\", HaIcon);\n","import { dedupingMixin } from \"@polymer/polymer/lib/utils/mixin\";\n/**\n * Polymer Mixin to enable a localize function powered by language/resources from hass object.\n *\n * @polymerMixin\n */\nexport default dedupingMixin(\n  (superClass) =>\n    class extends superClass {\n      static get properties() {\n        return {\n          hass: Object,\n\n          /**\n           * Translates a string to the current `language`. Any parameters to the\n           * string should be passed in order, as follows:\n           * `localize(stringKey, param1Name, param1Value, param2Name, param2Value)`\n           */\n          localize: {\n            type: Function,\n            computed: \"__computeLocalize(hass.localize)\",\n          },\n        };\n      }\n\n      __computeLocalize(localize) {\n        return localize;\n      }\n    }\n);\n","import { dedupingMixin } from \"@polymer/polymer/lib/utils/mixin\";\n\nimport { fireEvent } from \"../common/dom/fire_event\";\n\n// Polymer legacy event helpers used courtesy of the Polymer project.\n//\n// Copyright (c) 2017 The Polymer Authors. All rights reserved.\n//\n// Redistribution and use in source and binary forms, with or without\n// modification, are permitted provided that the following conditions are\n// met:\n//\n//    * Redistributions of source code must retain the above copyright\n// notice, this list of conditions and the following disclaimer.\n//    * Redistributions in binary form must reproduce the above\n// copyright notice, this list of conditions and the following disclaimer\n// in the documentation and/or other materials provided with the\n// distribution.\n//    * Neither the name of Google Inc. nor the names of its\n// contributors may be used to endorse or promote products derived from\n// this software without specific prior written permission.\n//\n// THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS\n// \"AS IS\" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT\n// LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR\n// A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT\n// OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,\n// SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT\n// LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE,\n// DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY\n// THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT\n// (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE\n// OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\n\n/* @polymerMixin */\nexport const EventsMixin = dedupingMixin(\n  (superClass) =>\n    class extends superClass {\n      /**\n   * Dispatches a custom event with an optional detail value.\n   *\n   * @param {string} type Name of event type.\n   * @param {*=} detail Detail value containing event-specific\n   *   payload.\n   * @param {{ bubbles: (boolean|undefined),\n               cancelable: (boolean|undefined),\n                composed: (boolean|undefined) }=}\n    *  options Object specifying options.  These may include:\n    *  `bubbles` (boolean, defaults to `true`),\n    *  `cancelable` (boolean, defaults to false), and\n    *  `node` on which to fire the event (HTMLElement, defaults to `this`).\n    * @return {Event} The new event that was fired.\n    */\n      fire(type, detail, options) {\n        options = options || {};\n        return fireEvent(options.node || this, type, detail, options);\n      }\n    }\n);\n","import { HassEntity } from \"home-assistant-js-websocket\";\nimport { computeDomain } from \"./compute_domain\";\n\nexport const computeStateDomain = (stateObj: HassEntity) => {\n  return computeDomain(stateObj.entity_id);\n};\n","/** Compute the object ID of a state. */\nexport const computeObjectId = (entityId: string): string => {\n  return entityId.substr(entityId.indexOf(\".\") + 1);\n};\n","import { Map } from \"leaflet\";\n\n// Sets up a Leaflet map on the provided DOM element\nexport type LeafletModuleType = typeof import(\"leaflet\");\nexport type LeafletDrawModuleType = typeof import(\"leaflet-draw\");\n\nexport const setupLeafletMap = async (\n  mapElement: HTMLElement,\n  darkMode = false,\n  draw = false\n): Promise<[Map, LeafletModuleType]> => {\n  if (!mapElement.parentNode) {\n    throw new Error(\"Cannot setup Leaflet map on disconnected element\");\n  }\n  // tslint:disable-next-line\n  const Leaflet = (await import(\n    /* webpackChunkName: \"leaflet\" */ \"leaflet\"\n  )) as LeafletModuleType;\n  Leaflet.Icon.Default.imagePath = \"/static/images/leaflet/images/\";\n\n  if (draw) {\n    await import(/* webpackChunkName: \"leaflet-draw\" */ \"leaflet-draw\");\n  }\n\n  const map = Leaflet.map(mapElement);\n  const style = document.createElement(\"link\");\n  style.setAttribute(\"href\", \"/static/images/leaflet/leaflet.css\");\n  style.setAttribute(\"rel\", \"stylesheet\");\n  mapElement.parentNode.appendChild(style);\n  map.setView([52.3731339, 4.8903147], 13);\n  createTileLayer(Leaflet, darkMode).addTo(map);\n\n  return [map, Leaflet];\n};\n\nexport const createTileLayer = (\n  leaflet: LeafletModuleType,\n  darkMode: boolean\n) => {\n  return leaflet.tileLayer(\n    `https://{s}.basemaps.cartocdn.com/${\n      darkMode ? \"dark_all\" : \"light_all\"\n    }/{z}/{x}/{y}${leaflet.Browser.retina ? \"@2x.png\" : \".png\"}`,\n    {\n      attribution:\n        '&copy; <a href=\"https://www.openstreetmap.org/copyright\">OpenStreetMap</a>, &copy; <a href=\"https://carto.com/attributions\">CARTO</a>',\n      subdomains: \"abcd\",\n      minZoom: 0,\n      maxZoom: 20,\n    }\n  );\n};\n","import { HomeAssistant } from \"../types\";\nimport { navigate } from \"../common/navigate\";\n\nexport const defaultRadiusColor = \"#FF9800\";\nexport const homeRadiusColor: string = \"#03a9f4\";\nexport const passiveRadiusColor: string = \"#9b9b9b\";\n\nexport interface Zone {\n  id: string;\n  name: string;\n  icon?: string;\n  latitude: number;\n  longitude: number;\n  passive?: boolean;\n  radius?: number;\n}\n\nexport interface ZoneMutableParams {\n  icon: string;\n  latitude: number;\n  longitude: number;\n  name: string;\n  passive: boolean;\n  radius: number;\n}\n\nexport const fetchZones = (hass: HomeAssistant) =>\n  hass.callWS<Zone[]>({ type: \"zone/list\" });\n\nexport const createZone = (hass: HomeAssistant, values: ZoneMutableParams) =>\n  hass.callWS<Zone>({\n    type: \"zone/create\",\n    ...values,\n  });\n\nexport const updateZone = (\n  hass: HomeAssistant,\n  zoneId: string,\n  updates: Partial<ZoneMutableParams>\n) =>\n  hass.callWS<Zone>({\n    type: \"zone/update\",\n    zone_id: zoneId,\n    ...updates,\n  });\n\nexport const deleteZone = (hass: HomeAssistant, zoneId: string) =>\n  hass.callWS({\n    type: \"zone/delete\",\n    zone_id: zoneId,\n  });\n\nlet inititialZoneEditorData: Partial<ZoneMutableParams> | undefined;\n\nexport const showZoneEditor = (\n  el: HTMLElement,\n  data?: Partial<ZoneMutableParams>\n) => {\n  inititialZoneEditorData = data;\n  navigate(el, \"/config/zone/new\");\n};\n\nexport const getZoneEditorInitData = () => {\n  const data = inititialZoneEditorData;\n  inititialZoneEditorData = undefined;\n  return data;\n};\n","/**\n@license\nCopyright (c) 2016 The Polymer Project Authors. All rights reserved.\nThis code may only be used under the BSD style license found at http://polymer.github.io/LICENSE.txt\nThe complete set of authors may be found at http://polymer.github.io/AUTHORS.txt\nThe complete set of contributors may be found at http://polymer.github.io/CONTRIBUTORS.txt\nCode distributed by Google as part of the polymer project is also\nsubject to an additional IP rights grant found at http://polymer.github.io/PATENTS.txt\n*/\nimport '@polymer/polymer/polymer-legacy.js';\n\nimport {Polymer} from '@polymer/polymer/lib/legacy/polymer-fn.js';\nimport {html} from '@polymer/polymer/lib/utils/html-tag.js';\nimport {resolveUrl} from '@polymer/polymer/lib/utils/resolve-url.js';\n\n/**\n`iron-image` is an element for displaying an image that provides useful sizing and\npreloading options not found on the standard `<img>` tag.\n\nThe `sizing` option allows the image to be either cropped (`cover`) or\nletterboxed (`contain`) to fill a fixed user-size placed on the element.\n\nThe `preload` option prevents the browser from rendering the image until the\nimage is fully loaded.  In the interim, either the element's CSS `background-color`\ncan be be used as the placeholder, or the `placeholder` property can be\nset to a URL (preferably a data-URI, for instant rendering) for an\nplaceholder image.\n\nThe `fade` option (only valid when `preload` is set) will cause the placeholder\nimage/color to be faded out once the image is rendered.\n\nExamples:\n\n  Basically identical to `<img src=\"...\">` tag:\n\n    <iron-image src=\"http://lorempixel.com/400/400\"></iron-image>\n\n  Will letterbox the image to fit:\n\n    <iron-image style=\"width:400px; height:400px;\" sizing=\"contain\"\n      src=\"http://lorempixel.com/600/400\"></iron-image>\n\n  Will crop the image to fit:\n\n    <iron-image style=\"width:400px; height:400px;\" sizing=\"cover\"\n      src=\"http://lorempixel.com/600/400\"></iron-image>\n\n  Will show light-gray background until the image loads:\n\n    <iron-image style=\"width:400px; height:400px; background-color: lightgray;\"\n      sizing=\"cover\" preload src=\"http://lorempixel.com/600/400\"></iron-image>\n\n  Will show a base-64 encoded placeholder image until the image loads:\n\n    <iron-image style=\"width:400px; height:400px;\" placeholder=\"data:image/gif;base64,...\"\n      sizing=\"cover\" preload src=\"http://lorempixel.com/600/400\"></iron-image>\n\n  Will fade the light-gray background out once the image is loaded:\n\n    <iron-image style=\"width:400px; height:400px; background-color: lightgray;\"\n      sizing=\"cover\" preload fade src=\"http://lorempixel.com/600/400\"></iron-image>\n\nCustom property | Description | Default\n----------------|-------------|----------\n`--iron-image-placeholder` | Mixin applied to #placeholder | `{}`\n`--iron-image-width` | Sets the width of the wrapped image | `auto`\n`--iron-image-height` | Sets the height of the wrapped image | `auto`\n\n@group Iron Elements\n@element iron-image\n@demo demo/index.html\n*/\nPolymer({\n  _template: html`\n    <style>\n      :host {\n        display: inline-block;\n        overflow: hidden;\n        position: relative;\n      }\n\n      #baseURIAnchor {\n        display: none;\n      }\n\n      #sizedImgDiv {\n        position: absolute;\n        top: 0px;\n        right: 0px;\n        bottom: 0px;\n        left: 0px;\n\n        display: none;\n      }\n\n      #img {\n        display: block;\n        width: var(--iron-image-width, auto);\n        height: var(--iron-image-height, auto);\n      }\n\n      :host([sizing]) #sizedImgDiv {\n        display: block;\n      }\n\n      :host([sizing]) #img {\n        display: none;\n      }\n\n      #placeholder {\n        position: absolute;\n        top: 0px;\n        right: 0px;\n        bottom: 0px;\n        left: 0px;\n\n        background-color: inherit;\n        opacity: 1;\n\n        @apply --iron-image-placeholder;\n      }\n\n      #placeholder.faded-out {\n        transition: opacity 0.5s linear;\n        opacity: 0;\n      }\n    </style>\n\n    <a id=\"baseURIAnchor\" href=\"#\"></a>\n    <div id=\"sizedImgDiv\" role=\"img\" hidden$=\"[[_computeImgDivHidden(sizing)]]\" aria-hidden$=\"[[_computeImgDivARIAHidden(alt)]]\" aria-label$=\"[[_computeImgDivARIALabel(alt, src)]]\"></div>\n    <img id=\"img\" alt$=\"[[alt]]\" hidden$=\"[[_computeImgHidden(sizing)]]\" crossorigin$=\"[[crossorigin]]\" on-load=\"_imgOnLoad\" on-error=\"_imgOnError\">\n    <div id=\"placeholder\" hidden$=\"[[_computePlaceholderHidden(preload, fade, loading, loaded)]]\" class$=\"[[_computePlaceholderClassName(preload, fade, loading, loaded)]]\"></div>\n`,\n\n  is: 'iron-image',\n\n  properties: {\n    /**\n     * The URL of an image.\n     */\n    src: {type: String, value: ''},\n\n    /**\n     * A short text alternative for the image.\n     */\n    alt: {type: String, value: null},\n\n    /**\n     * CORS enabled images support:\n     * https://developer.mozilla.org/en-US/docs/Web/HTML/CORS_enabled_image\n     */\n    crossorigin: {type: String, value: null},\n\n    /**\n     * When true, the image is prevented from loading and any placeholder is\n     * shown.  This may be useful when a binding to the src property is known to\n     * be invalid, to prevent 404 requests.\n     */\n    preventLoad: {type: Boolean, value: false},\n\n    /**\n     * Sets a sizing option for the image.  Valid values are `contain` (full\n     * aspect ratio of the image is contained within the element and\n     * letterboxed) or `cover` (image is cropped in order to fully cover the\n     * bounds of the element), or `null` (default: image takes natural size).\n     */\n    sizing: {type: String, value: null, reflectToAttribute: true},\n\n    /**\n     * When a sizing option is used (`cover` or `contain`), this determines\n     * how the image is aligned within the element bounds.\n     */\n    position: {type: String, value: 'center'},\n\n    /**\n     * When `true`, any change to the `src` property will cause the\n     * `placeholder` image to be shown until the new image has loaded.\n     */\n    preload: {type: Boolean, value: false},\n\n    /**\n     * This image will be used as a background/placeholder until the src image\n     * has loaded.  Use of a data-URI for placeholder is encouraged for instant\n     * rendering.\n     */\n    placeholder: {type: String, value: null, observer: '_placeholderChanged'},\n\n    /**\n     * When `preload` is true, setting `fade` to true will cause the image to\n     * fade into place.\n     */\n    fade: {type: Boolean, value: false},\n\n    /**\n     * Read-only value that is true when the image is loaded.\n     */\n    loaded: {notify: true, readOnly: true, type: Boolean, value: false},\n\n    /**\n     * Read-only value that tracks the loading state of the image when the\n     * `preload` option is used.\n     */\n    loading: {notify: true, readOnly: true, type: Boolean, value: false},\n\n    /**\n     * Read-only value that indicates that the last set `src` failed to load.\n     */\n    error: {notify: true, readOnly: true, type: Boolean, value: false},\n\n    /**\n     * Can be used to set the width of image (e.g. via binding); size may also\n     * be set via CSS.\n     */\n    width: {observer: '_widthChanged', type: Number, value: null},\n\n    /**\n     * Can be used to set the height of image (e.g. via binding); size may also\n     * be set via CSS.\n     *\n     * @attribute height\n     * @type number\n     * @default null\n     */\n    height: {observer: '_heightChanged', type: Number, value: null},\n  },\n\n  observers: [\n    '_transformChanged(sizing, position)',\n    '_loadStateObserver(src, preventLoad)'\n  ],\n\n  created: function() {\n    this._resolvedSrc = '';\n  },\n\n  _imgOnLoad: function() {\n    if (this.$.img.src !== this._resolveSrc(this.src)) {\n      return;\n    }\n\n    this._setLoading(false);\n    this._setLoaded(true);\n    this._setError(false);\n  },\n\n  _imgOnError: function() {\n    if (this.$.img.src !== this._resolveSrc(this.src)) {\n      return;\n    }\n\n    this.$.img.removeAttribute('src');\n    this.$.sizedImgDiv.style.backgroundImage = '';\n\n    this._setLoading(false);\n    this._setLoaded(false);\n    this._setError(true);\n  },\n\n  _computePlaceholderHidden: function() {\n    return !this.preload || (!this.fade && !this.loading && this.loaded);\n  },\n\n  _computePlaceholderClassName: function() {\n    return (this.preload && this.fade && !this.loading && this.loaded) ?\n        'faded-out' :\n        '';\n  },\n\n  _computeImgDivHidden: function() {\n    return !this.sizing;\n  },\n\n  _computeImgDivARIAHidden: function() {\n    return this.alt === '' ? 'true' : undefined;\n  },\n\n  _computeImgDivARIALabel: function() {\n    if (this.alt !== null) {\n      return this.alt;\n    }\n\n    // Polymer.ResolveUrl.resolveUrl will resolve '' relative to a URL x to\n    // that URL x, but '' is the default for src.\n    if (this.src === '') {\n      return '';\n    }\n\n    // NOTE: Use of `URL` was removed here because IE11 doesn't support\n    // constructing it. If this ends up being problematic, we should\n    // consider reverting and adding the URL polyfill as a dev dependency.\n    var resolved = this._resolveSrc(this.src);\n    // Remove query parts, get file name.\n    return resolved.replace(/[?|#].*/g, '').split('/').pop();\n  },\n\n  _computeImgHidden: function() {\n    return !!this.sizing;\n  },\n\n  _widthChanged: function() {\n    this.style.width = isNaN(this.width) ? this.width : this.width + 'px';\n  },\n\n  _heightChanged: function() {\n    this.style.height = isNaN(this.height) ? this.height : this.height + 'px';\n  },\n\n  _loadStateObserver: function(src, preventLoad) {\n    var newResolvedSrc = this._resolveSrc(src);\n    if (newResolvedSrc === this._resolvedSrc) {\n      return;\n    }\n\n    this._resolvedSrc = '';\n    this.$.img.removeAttribute('src');\n    this.$.sizedImgDiv.style.backgroundImage = '';\n\n    if (src === '' || preventLoad) {\n      this._setLoading(false);\n      this._setLoaded(false);\n      this._setError(false);\n    } else {\n      this._resolvedSrc = newResolvedSrc;\n      this.$.img.src = this._resolvedSrc;\n      this.$.sizedImgDiv.style.backgroundImage =\n          'url(\"' + this._resolvedSrc + '\")';\n\n      this._setLoading(true);\n      this._setLoaded(false);\n      this._setError(false);\n    }\n  },\n\n  _placeholderChanged: function() {\n    this.$.placeholder.style.backgroundImage =\n        this.placeholder ? 'url(\"' + this.placeholder + '\")' : '';\n  },\n\n  _transformChanged: function() {\n    var sizedImgDivStyle = this.$.sizedImgDiv.style;\n    var placeholderStyle = this.$.placeholder.style;\n\n    sizedImgDivStyle.backgroundSize = placeholderStyle.backgroundSize =\n        this.sizing;\n\n    sizedImgDivStyle.backgroundPosition = placeholderStyle.backgroundPosition =\n        this.sizing ? this.position : '';\n\n    sizedImgDivStyle.backgroundRepeat = placeholderStyle.backgroundRepeat =\n        this.sizing ? 'no-repeat' : '';\n  },\n\n  _resolveSrc: function(testSrc) {\n    var resolved = resolveUrl(testSrc, this.$.baseURIAnchor.href);\n    // NOTE: Use of `URL` was removed here because IE11 doesn't support\n    // constructing it. If this ends up being problematic, we should\n    // consider reverting and adding the URL polyfill as a dev dependency.\n    if (resolved.length >= 2 && resolved[0] === '/' && resolved[1] !== '/') {\n      // In IE location.origin might not work\n      // https://connect.microsoft.com/IE/feedback/details/1763802/location-origin-is-undefined-in-ie-11-on-windows-10-but-works-on-windows-7\n      resolved = (location.origin || location.protocol + '//' + location.host) +\n          resolved;\n    }\n    return resolved;\n  }\n});\n","import \"@polymer/iron-image/iron-image\";\nimport { html } from \"@polymer/polymer/lib/utils/html-tag\";\nimport { PolymerElement } from \"@polymer/polymer/polymer-element\";\n\nimport { EventsMixin } from \"../../mixins/events-mixin\";\n\n/*\n * @appliesMixin EventsMixin\n */\nclass HaEntityMarker extends EventsMixin(PolymerElement) {\n  static get template() {\n    return html`\n      <style include=\"iron-positioning\"></style>\n      <style>\n        .marker {\n          vertical-align: top;\n          position: relative;\n          display: block;\n          margin: 0 auto;\n          width: 2.5em;\n          text-align: center;\n          height: 2.5em;\n          line-height: 2.5em;\n          font-size: 1.5em;\n          border-radius: 50%;\n          border: 0.1em solid\n            var(--ha-marker-color, var(--default-primary-color));\n          color: rgb(76, 76, 76);\n          background-color: white;\n        }\n        iron-image {\n          border-radius: 50%;\n        }\n      </style>\n\n      <div class=\"marker\" style$=\"border-color:{{entityColor}}\">\n        <template is=\"dom-if\" if=\"[[entityName]]\">[[entityName]]</template>\n        <template is=\"dom-if\" if=\"[[entityPicture]]\">\n          <iron-image\n            sizing=\"cover\"\n            class=\"fit\"\n            src=\"[[entityPicture]]\"\n          ></iron-image>\n        </template>\n      </div>\n    `;\n  }\n\n  static get properties() {\n    return {\n      hass: {\n        type: Object,\n      },\n\n      entityId: {\n        type: String,\n        value: \"\",\n      },\n\n      entityName: {\n        type: String,\n        value: null,\n      },\n\n      entityPicture: {\n        type: String,\n        value: null,\n      },\n\n      entityColor: {\n        type: String,\n        value: null,\n      },\n    };\n  }\n\n  ready() {\n    super.ready();\n    this.addEventListener(\"click\", (ev) => this.badgeTap(ev));\n  }\n\n  badgeTap(ev) {\n    ev.stopPropagation();\n    if (this.entityId) {\n      this.fire(\"hass-more-info\", { entityId: this.entityId });\n    }\n  }\n}\n\ncustomElements.define(\"ha-entity-marker\", HaEntityMarker);\n","import \"@polymer/app-layout/app-toolbar/app-toolbar\";\nimport { html } from \"@polymer/polymer/lib/utils/html-tag\";\nimport { PolymerElement } from \"@polymer/polymer/polymer-element\";\n\nimport \"../../components/ha-menu-button\";\nimport \"../../components/ha-icon\";\nimport { navigate } from \"../../common/navigate\";\n\nimport \"./ha-entity-marker\";\n\nimport { computeStateDomain } from \"../../common/entity/compute_state_domain\";\nimport { computeStateName } from \"../../common/entity/compute_state_name\";\nimport LocalizeMixin from \"../../mixins/localize-mixin\";\nimport { setupLeafletMap } from \"../../common/dom/setup-leaflet-map\";\nimport { defaultRadiusColor } from \"../../data/zone\";\n\n/*\n * @appliesMixin LocalizeMixin\n */\nclass HaPanelMap extends LocalizeMixin(PolymerElement) {\n  static get template() {\n    return html`\n      <style include=\"ha-style\">\n        #map {\n          height: calc(100% - 64px);\n          width: 100%;\n          z-index: 0;\n        }\n\n        .light {\n          color: #000000;\n        }\n      </style>\n\n      <app-toolbar>\n        <ha-menu-button hass=\"[[hass]]\" narrow=\"[[narrow]]\"></ha-menu-button>\n        <div main-title>[[localize('panel.map')]]</div>\n        <template is=\"dom-if\" if=\"[[computeShowEditZone(hass)]]\">\n          <paper-icon-button\n            icon=\"hass:pencil\"\n            on-click=\"openZonesEditor\"\n          ></paper-icon-button>\n        </template>\n      </app-toolbar>\n\n      <div id=\"map\"></div>\n    `;\n  }\n\n  static get properties() {\n    return {\n      hass: {\n        type: Object,\n        observer: \"drawEntities\",\n      },\n      narrow: Boolean,\n    };\n  }\n\n  connectedCallback() {\n    super.connectedCallback();\n    this.loadMap();\n  }\n\n  async loadMap() {\n    [this._map, this.Leaflet] = await setupLeafletMap(this.$.map);\n    this.drawEntities(this.hass);\n    this._map.invalidateSize();\n    this.fitMap();\n  }\n\n  disconnectedCallback() {\n    if (this._map) {\n      this._map.remove();\n    }\n  }\n\n  computeShowEditZone(hass) {\n    return !__DEMO__ && hass.user.is_admin;\n  }\n\n  openZonesEditor() {\n    navigate(this, \"/config/zone\");\n  }\n\n  fitMap() {\n    var bounds;\n\n    if (this._mapItems.length === 0) {\n      this._map.setView(\n        new this.Leaflet.LatLng(\n          this.hass.config.latitude,\n          this.hass.config.longitude\n        ),\n        14\n      );\n    } else {\n      bounds = new this.Leaflet.latLngBounds(\n        this._mapItems.map((item) => item.getLatLng())\n      );\n      this._map.fitBounds(bounds.pad(0.5));\n    }\n  }\n\n  drawEntities(hass) {\n    /* eslint-disable vars-on-top */\n    var map = this._map;\n    if (!map) return;\n\n    if (this._mapItems) {\n      this._mapItems.forEach(function(marker) {\n        marker.remove();\n      });\n    }\n    var mapItems = (this._mapItems = []);\n\n    if (this._mapZones) {\n      this._mapZones.forEach(function(marker) {\n        marker.remove();\n      });\n    }\n    var mapZones = (this._mapZones = []);\n\n    Object.keys(hass.states).forEach((entityId) => {\n      var entity = hass.states[entityId];\n\n      if (\n        (entity.attributes.hidden && computeStateDomain(entity) !== \"zone\") ||\n        entity.state === \"home\" ||\n        !(\"latitude\" in entity.attributes) ||\n        !(\"longitude\" in entity.attributes)\n      ) {\n        return;\n      }\n\n      var title = computeStateName(entity);\n      var icon;\n\n      if (computeStateDomain(entity) === \"zone\") {\n        // DRAW ZONE\n        if (entity.attributes.passive) return;\n\n        // create icon\n        var iconHTML = \"\";\n        if (entity.attributes.icon) {\n          const el = document.createElement(\"ha-icon\");\n          el.setAttribute(\"icon\", entity.attributes.icon);\n          iconHTML = el.outerHTML;\n        } else {\n          const el = document.createElement(\"span\");\n          el.innerHTML = title;\n          iconHTML = el.outerHTML;\n        }\n\n        icon = this.Leaflet.divIcon({\n          html: iconHTML,\n          iconSize: [24, 24],\n          className: \"light\",\n        });\n\n        // create marker with the icon\n        mapZones.push(\n          this.Leaflet.marker(\n            [entity.attributes.latitude, entity.attributes.longitude],\n            {\n              icon: icon,\n              interactive: false,\n              title: title,\n            }\n          ).addTo(map)\n        );\n\n        // create circle around it\n        mapZones.push(\n          this.Leaflet.circle(\n            [entity.attributes.latitude, entity.attributes.longitude],\n            {\n              interactive: false,\n              color: defaultRadiusColor,\n              radius: entity.attributes.radius,\n            }\n          ).addTo(map)\n        );\n\n        return;\n      }\n\n      // DRAW ENTITY\n      // create icon\n      var entityPicture = entity.attributes.entity_picture || \"\";\n      var entityName = title\n        .split(\" \")\n        .map(function(part) {\n          return part.substr(0, 1);\n        })\n        .join(\"\");\n      /* Leaflet clones this element before adding it to the map. This messes up\n         our Polymer object and we can't pass data through. Thus we hack like this. */\n      icon = this.Leaflet.divIcon({\n        html:\n          \"<ha-entity-marker entity-id='\" +\n          entity.entity_id +\n          \"' entity-name='\" +\n          entityName +\n          \"' entity-picture='\" +\n          entityPicture +\n          \"'></ha-entity-marker>\",\n        iconSize: [45, 45],\n        className: \"\",\n      });\n\n      // create market with the icon\n      mapItems.push(\n        this.Leaflet.marker(\n          [entity.attributes.latitude, entity.attributes.longitude],\n          {\n            icon: icon,\n            title: computeStateName(entity),\n          }\n        ).addTo(map)\n      );\n\n      // create circle around if entity has accuracy\n      if (entity.attributes.gps_accuracy) {\n        mapItems.push(\n          this.Leaflet.circle(\n            [entity.attributes.latitude, entity.attributes.longitude],\n            {\n              interactive: false,\n              color: \"#0288D1\",\n              radius: entity.attributes.gps_accuracy,\n            }\n          ).addTo(map)\n        );\n      }\n    });\n  }\n}\n\ncustomElements.define(\"ha-panel-map\", HaPanelMap);\n"],"sourceRoot":""}